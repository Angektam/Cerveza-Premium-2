<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cerveza Premium - Sistema de Ventas</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

</head>
<body>
    <main class="main-content">
        <!-- Vista de Login -->
      <section id="loginView" class="view active">
        <div class="login-container">
          <div class="logo-section">
                    <div class="beer-icon">
                        <i class="fas fa-beer"></i>
                    </div>
                    <h1 class="brand-title">Cerveza Premium</h1>
                    <p class="brand-subtitle">Tu experiencia cervecera personalizada</p>
          </div>

                <form id="loginForm" class="form-section">
            <div class="form-group">
              <label class="form-label" for="email">Correo Electrónico</label>
              <input 
                type="email" 
                id="email" 
                name="email" 
                class="form-input" 
                            placeholder="tu&#64;email.com"
                required
              />
            </div>

            <div class="form-group">
              <label class="form-label" for="password">Contraseña</label>
              <input 
                type="password" 
                id="password" 
                name="password" 
                class="form-input" 
                placeholder="••••••••"
                required
              />
                        <span class="password-toggle" id="togglePassword">
                <i class="fas fa-eye"></i>
              </span>
            </div>

            <div class="form-options">
              <label class="remember-me">
                            <input type="checkbox" id="rememberMe">
                            <span>Recordarme</span>
              </label>
              <a href="#" class="forgot-password" onclick="showForgotPasswordForm()">¿Olvidaste tu contraseña?</a>
            </div>

            <button type="submit" class="login-button">
              Iniciar Sesión
            </button>
          </form>

          <div class="signup-section">
                    <p>
                        ¿No tienes una cuenta? 
                        <a href="#" class="signup-link" id="showSignup">Regístrate</a>
                        <span style="color:#b71c1c; font-size:14px; display:block; margin-top:6px;">
                            Para registrarte, necesitaremos datos importantes para validar que eres mayor de edad.
                        </span>
                    </p>
                    <div class="age-verification-info" style="margin-top: 10px; color: #b71c1c; font-size: 15px;">
                        <i class="fas fa-exclamation-triangle"></i>
                        <span>
                            Es obligatorio ser mayor de edad (18+) para comprar cerveza. Durante el registro, te pediremos tu fecha de nacimiento y validaremos que cumplas con la mayoría de edad.
                        </span>
                    </div>
                    <div class="admin-access" style="margin-top: 20px; text-align: center;">
                        <a href="#" class="admin-link" onclick="showAdminLogin()" style="color: #e74c3c; font-size: 14px;">
                            <i class="fas fa-cog"></i> Acceso Administrador
                        </a>
                    </div>
          </div>
        </div>
      </section>

      <!-- Vista de Forgot Password -->
      <section id="forgotPasswordView" class="view">
        <div class="login-container">
          <div class="login-header">
            <h2>Restablecer Contraseña</h2>
            <p>Ingresa tu email y te enviaremos un enlace para restablecer tu contraseña</p>
          </div>

          <form id="forgotPasswordForm" class="login-form">
            <div class="form-group">
              <label for="forgotEmail" class="form-label">Correo Electrónico</label>
              <input 
                type="email" 
                id="forgotEmail" 
                class="form-input" 
                placeholder="tu@email.com"
                required
              >
            </div>

            <button type="submit" class="login-button">
              <span class="button-text">Enviar Enlace</span>
              <span class="loading-spinner" style="display: none;"></span>
            </button>

            <div class="form-footer">
              <a href="#" class="back-to-login" onclick="showLoginForm()">
                <i class="fas fa-arrow-left"></i> Volver al Login
              </a>
            </div>
          </form>
        </div>
      </section>

      <!-- Vista de Reset Password -->
      <section id="resetPasswordView" class="view">
        <div class="login-container">
          <div class="login-header">
            <h2>Nueva Contraseña</h2>
            <p>Ingresa tu nueva contraseña</p>
          </div>

          <form id="resetPasswordForm" class="login-form">
            <div class="form-group">
              <label for="resetNewPassword" class="form-label">Nueva Contraseña</label>
              <div class="password-input-container">
                <input 
                  type="password" 
                  id="resetNewPassword" 
                  class="form-input" 
                  placeholder="Mínimo 8 caracteres"
                  required
                  minlength="8"
                >
                <button type="button" class="password-toggle" onclick="togglePassword('resetNewPassword', 'toggleResetNewPassword')">
                  <i class="fas fa-eye" id="toggleResetNewPassword"></i>
                </button>
              </div>
            </div>

            <div class="form-group">
              <label for="resetConfirmNewPassword" class="form-label">Confirmar Nueva Contraseña</label>
              <div class="password-input-container">
                <input 
                  type="password" 
                  id="resetConfirmNewPassword" 
                  class="form-input" 
                  placeholder="Repite tu nueva contraseña"
                  required
                  minlength="8"
                >
                <button type="button" class="password-toggle" onclick="togglePassword('resetConfirmNewPassword', 'toggleResetConfirmNewPassword')">
                  <i class="fas fa-eye" id="toggleResetConfirmNewPassword"></i>
                </button>
              </div>
            </div>

            <button type="submit" class="login-button">
              <span class="button-text">Restablecer Contraseña</span>
              <span class="loading-spinner" style="display: none;"></span>
            </button>

            <div class="form-footer">
              <a href="#" class="back-to-login" onclick="showLoginForm()">
                <i class="fas fa-arrow-left"></i> Volver al Login
              </a>
            </div>
          </form>
        </div>
      </section>

      <!-- Vista de Admin Login -->
      <section id="adminLoginView" class="view">
        <div class="login-container">
          <div class="login-header">
            <h2>Panel de Administración</h2>
            <p>Acceso exclusivo para administradores y vendedores</p>
          </div>

          <form id="adminLoginForm" class="login-form">
            <div class="form-group">
              <label for="adminEmail" class="form-label">Correo Electrónico</label>
              <input 
                type="email" 
                id="adminEmail" 
                class="form-input" 
                placeholder="admin@cervezapremium.com"
                required
              >
            </div>

            <div class="form-group">
              <label for="adminPassword" class="form-label">Contraseña</label>
              <div class="password-input-container">
                <input 
                  type="password" 
                  id="adminPassword" 
                  class="form-input" 
                  placeholder="Tu contraseña"
                  required
                >
                <button type="button" class="password-toggle" onclick="togglePassword('adminPassword', 'toggleAdminPassword')">
                  <i class="fas fa-eye" id="toggleAdminPassword"></i>
                </button>
              </div>
            </div>

            <button type="submit" class="login-button">
              <span class="button-text">Acceder al Panel</span>
              <span class="loading-spinner" style="display: none;"></span>
            </button>

            <div class="form-footer">
              <a href="#" class="back-to-login" onclick="showLoginForm()">
                <i class="fas fa-arrow-left"></i> Volver al Login
              </a>
            </div>
          </form>
        </div>
      </section>

      <!-- Vista de Admin Dashboard -->
      <section id="adminDashboardView" class="view">
        <div class="admin-container">
          <!-- Header del Admin Mejorado -->
          <header class="admin-header">
            <div class="admin-header-content">
            <div class="admin-header-left">
                <div class="admin-title-wrapper">
                  <div class="admin-title-icon">
                    <i class="fas fa-cog"></i>
                  </div>
                  <div class="admin-title-text">
                    <h1>Panel de Administración</h1>
                    <span class="admin-role">
                      <i class="fas fa-shield-alt"></i>
                      {{currentUser?.rol === 'admin' ? 'Administrador Sistema' : 'Vendedor'}}
                    </span>
                  </div>
                </div>
            </div>
            <div class="admin-header-right">
                <div class="admin-user-info">
                  <i class="fas fa-user-circle"></i>
              <span class="admin-user">{{currentUser?.nombre_completo}}</span>
                </div>
                <button class="admin-logout-btn" onclick="logoutAdmin()">
                  <i class="fas fa-sign-out-alt"></i>
                  <span>Cerrar Sesión</span>
              </button>
              </div>
            </div>
          </header>

          <!-- Navegación del Admin Mejorada -->
          <div class="admin-nav-section">
            <div class="admin-nav-grid">
              <div class="admin-nav-card active" onclick="showAdminSection('dashboard')">
                <div class="nav-card-icon dashboard-icon">
                  <i class="fas fa-chart-bar"></i>
                </div>
                <div class="nav-card-content">
                  <h3>Dashboard</h3>
                  <p>Vista general del sistema</p>
                </div>
                <div class="nav-card-indicator"></div>
              </div>

              <div class="admin-nav-card" onclick="showAdminSection('cervezas')">
                <div class="nav-card-icon cervezas-icon">
                  <i class="fas fa-beer"></i>
                </div>
                <div class="nav-card-content">
                  <h3>Cervezas</h3>
                  <p>Gestión de productos</p>
                </div>
                <div class="nav-card-indicator"></div>
              </div>

              <div class="admin-nav-card" onclick="showAdminSection('pedidos')">
                <div class="nav-card-icon pedidos-icon">
                  <i class="fas fa-shopping-cart"></i>
                </div>
                <div class="nav-card-content">
                  <h3>Pedidos</h3>
                  <p>Gestión de pedidos</p>
                </div>
                <div class="nav-card-indicator"></div>
              </div>

              <div class="admin-nav-card" onclick="showAdminSection('usuarios')" *ngIf="currentUser?.rol === 'admin'">
                <div class="nav-card-icon usuarios-icon">
                  <i class="fas fa-users"></i>
                </div>
                <div class="nav-card-content">
                  <h3>Usuarios</h3>
                  <p>Gestión de usuarios</p>
                </div>
                <div class="nav-card-indicator"></div>
              </div>

              <div class="admin-nav-card" onclick="showAdminSection('reportes')">
                <div class="nav-card-icon reportes-icon">
                  <i class="fas fa-chart-line"></i>
                </div>
                <div class="nav-card-content">
                  <h3>Reportes</h3>
                  <p>Análisis y estadísticas</p>
                </div>
                <div class="nav-card-indicator"></div>
              </div>

              <div class="admin-nav-card" onclick="showAdminSection('notificaciones')">
                <div class="nav-card-icon notificaciones-icon">
                  <i class="fas fa-bell"></i>
                </div>
                <div class="nav-card-content">
                  <h3>Notificaciones</h3>
                  <p>Gestión de alertas</p>
                </div>
                <div class="nav-card-indicator"></div>
              </div>

              <div class="admin-nav-card" onclick="showAdminSection('descuentos')">
                <div class="nav-card-icon descuentos-icon">
                  <i class="fas fa-percent"></i>
                </div>
                <div class="nav-card-content">
                  <h3>Descuentos</h3>
                  <p>Promociones y ofertas</p>
                </div>
                <div class="nav-card-indicator"></div>
              </div>

              <div class="admin-nav-card" onclick="showAdminSection('domicilio')">
                <div class="nav-card-icon domicilio-icon">
                  <i class="fas fa-truck"></i>
                </div>
                <div class="nav-card-content">
                  <h3>Servicio a Domicilio</h3>
                  <p>Gestión de entregas</p>
                </div>
                <div class="nav-card-indicator"></div>
              </div>

              <div class="admin-nav-card" onclick="showAdminSection('corte-diario')">
                <div class="nav-card-icon corte-icon">
                  <i class="fas fa-cash-register"></i>
                </div>
                <div class="nav-card-content">
                  <h3>Corte Diario</h3>
                  <p>Ventas del día</p>
                </div>
                <div class="nav-card-indicator"></div>
              </div>

              <div class="admin-nav-card" onclick="showAdminSection('repartidores')">
                <div class="nav-card-icon repartidores-icon">
                  <i class="fas fa-route"></i>
                </div>
                <div class="nav-card-content">
                  <h3>Rutas de Repartidores</h3>
                  <p>Tracking en tiempo real</p>
                </div>
                <div class="nav-card-indicator"></div>
              </div>
            </div>
          </div>

          <!-- Contenido del Admin -->
          <main class="admin-content">
            <!-- Dashboard -->
            <div id="adminDashboardSection" class="admin-section active">
              <div class="stats-grid">
                <div class="stat-card">
                  <div class="stat-icon">
                    <i class="fas fa-users"></i>
                  </div>
                  <div class="stat-content">
                    <h3>{{adminStats?.usuarios?.total_usuarios || 0}}</h3>
                    <p>Total Usuarios</p>
                    <small>{{adminStats?.usuarios?.clientes || 0}} clientes</small>
                  </div>
                </div>

                <div class="stat-card">
                  <div class="stat-icon">
                    <i class="fas fa-beer"></i>
                  </div>
                  <div class="stat-content">
                    <h3>{{adminStats?.cervezas?.cervezas_activas || 0}}</h3>
                    <p>Cervezas Activas</p>
                    <small>{{adminStats?.cervezas?.stock_total || 0}} en stock</small>
                  </div>
                </div>

                <div class="stat-card">
                  <div class="stat-icon">
                    <i class="fas fa-shopping-cart"></i>
                  </div>
                  <div class="stat-content">
                    <h3>{{adminStats?.pedidos?.total_pedidos || 0}}</h3>
                    <p>Total Pedidos</p>
                    <small>{{adminStats?.pedidos?.pedidos_pendientes || 0}} pendientes</small>
                  </div>
                </div>

                <div class="stat-card">
                  <div class="stat-icon">
                    <i class="fas fa-dollar-sign"></i>
                  </div>
                  <div class="stat-content">
                    <h3>${{adminStats?.pedidos?.ventas_totales || 0}}</h3>
                    <p>Ventas Totales</p>
                    <small>${{adminStats?.pedidos?.ticket_promedio || 0}} promedio</small>
                  </div>
                </div>
              </div>

              <div class="charts-section">
                <div class="chart-card">
                  <h3>Ventas Mensuales</h3>
                  <div class="chart-placeholder">
                    <p>Gráfico de ventas por mes</p>
                    <div class="chart-data" *ngFor="let venta of adminStats?.ventas_mensuales">
                      <span>{{venta.mes}}</span>
                      <span>${{venta.ventas}}</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Gestión de Cervezas -->
            <div id="adminCervezasSection" class="admin-section">
              <div class="section-header">
                <h2>Gestión de Cervezas</h2>
                <div class="section-actions">
                  <button class="btn-primary" onclick="showAddBeerForm()">
                    <i class="fas fa-plus"></i> Nueva Cerveza
                  </button>
                  <button class="btn-secondary" onclick="loadAdminCervezas()">
                    <i class="fas fa-sync"></i> Actualizar
                  </button>
                </div>
              </div>

              <div class="beers-table">
                <table>
                  <thead>
                    <tr>
                      <th>Imagen</th>
                      <th>Nombre</th>
                      <th>Estilo</th>
                      <th>Precio</th>
                      <th>Stock</th>
                      <th>Estado</th>
                      <th>Acciones</th>
                    </tr>
                  </thead>
                  <tbody id="beersTableBody">
                    <!-- Se llena dinámicamente -->
                  </tbody>
                </table>
              </div>
            </div>

            <!-- Gestión de Pedidos -->
            <div id="adminPedidosSection" class="admin-section">
              <div class="section-header">
                <h2>Gestión de Pedidos</h2>
                <div class="filters">
                  <select id="pedidosFilter" onchange="filterPedidos()">
                    <option value="">Todos los estados</option>
                    <option value="pendiente">Pendientes</option>
                    <option value="confirmado">Confirmados</option>
                    <option value="en_preparacion">En Preparación</option>
                    <option value="enviado">Enviados</option>
                    <option value="entregado">Entregados</option>
                    <option value="cancelado">Cancelados</option>
                  </select>
                </div>
              </div>

              <div class="orders-table">
                <table>
                  <thead>
                    <tr>
                      <th>ID</th>
                      <th>Cliente</th>
                      <th>Fecha</th>
                      <th>Total</th>
                      <th>Método de Pago</th>
                      <th>Estado</th>
                      <th>Acciones</th>
                    </tr>
                  </thead>
                  <tbody id="ordersTableBody">
                    <!-- Se llena dinámicamente -->
                  </tbody>
                </table>
              </div>
            </div>

            <!-- Gestión de Usuarios (Solo Admin) -->
            <div id="adminUsuariosSection" class="admin-section" *ngIf="currentUser?.rol === 'admin'">
              <div class="section-header">
                <h2>Gestión de Usuarios</h2>
                <div class="filters">
                  <select id="usuariosFilter" onchange="filterUsuarios()">
                    <option value="">Todos los roles</option>
                    <option value="cliente">Clientes</option>
                    <option value="vendedor">Vendedores</option>
                    <option value="admin">Administradores</option>
                  </select>
                </div>
              </div>

              <div class="users-table">
                <table>
                  <thead>
                    <tr>
                      <th>ID</th>
                      <th>Nombre</th>
                      <th>Email</th>
                      <th>Rol</th>
                      <th>Registro</th>
                      <th>Acciones</th>
                    </tr>
                  </thead>
                  <tbody id="usersTableBody">
                    <!-- Se llena dinámicamente -->
                  </tbody>
                </table>
              </div>
            </div>

            <!-- Reportes Avanzados -->
            <div id="adminReportesSection" class="admin-section">
              <div class="section-header">
                <h2>Reportes y Analytics</h2>
                <div class="section-actions">
                  <select id="reportePeriodo" onchange="cargarReportes()">
                    <option value="30">Últimos 30 días</option>
                    <option value="7">Últimos 7 días</option>
                    <option value="90">Últimos 90 días</option>
                    <option value="custom">Rango personalizado</option>
                  </select>
                  <button class="btn-primary" onclick="cargarReportes()">
                    <i class="fas fa-sync"></i> Actualizar
                  </button>
                </div>
              </div>

              <!-- Métricas principales -->
              <div class="metrics-grid">
                <div class="metric-card">
                  <div class="metric-icon">
                    <i class="fas fa-dollar-sign"></i>
                  </div>
                  <div class="metric-content">
                    <h3 id="ventasTotales">$0</h3>
                    <p>Ventas Totales</p>
                    <small id="ticketPromedio">$0 promedio</small>
                  </div>
                </div>

                <div class="metric-card">
                  <div class="metric-icon">
                    <i class="fas fa-shopping-cart"></i>
                  </div>
                  <div class="metric-content">
                    <h3 id="totalPedidos">0</h3>
                    <p>Total Pedidos</p>
                    <small id="clientesUnicos">0 clientes únicos</small>
                  </div>
                </div>

                <div class="metric-card">
                  <div class="metric-icon">
                    <i class="fas fa-chart-line"></i>
                  </div>
                  <div class="metric-content">
                    <h3 id="tasaConversion">0%</h3>
                    <p>Tasa de Conversión</p>
                    <small id="clientesActivos">0 clientes activos</small>
                  </div>
                </div>

                <div class="metric-card">
                  <div class="metric-icon">
                    <i class="fas fa-clock"></i>
                  </div>
                  <div class="metric-content">
                    <h3 id="diasPromedio">0</h3>
                    <p>Días entre Pedidos</p>
                    <small>Promedio de frecuencia</small>
                  </div>
                </div>
              </div>

              <!-- Gráficos -->
              <div class="charts-grid">
                <div class="chart-container">
                  <h3>Ventas por Período</h3>
                  <div class="chart-placeholder" id="chartVentas">
                    <canvas id="ventasChart" width="400" height="200"></canvas>
                  </div>
                </div>

                <div class="chart-container">
                  <h3>Productos Más Vendidos</h3>
                  <div class="top-products" id="topProducts">
                    <!-- Se llena dinámicamente -->
                  </div>
                </div>
              </div>

              <!-- Clientes más activos -->
              <div class="chart-container">
                <h3>Clientes Más Activos</h3>
                <div class="top-customers" id="topCustomers">
                  <!-- Se llena dinámicamente -->
                </div>
              </div>

              <!-- Predicción de demanda -->
              <div class="chart-container">
                <h3>Predicción de Demanda</h3>
                <div class="demand-prediction" id="demandPrediction">
                  <!-- Se llena dinámicamente -->
                </div>
              </div>
            </div>

            <!-- Sistema de Notificaciones -->
            <div id="adminNotificacionesSection" class="admin-section">
              <div class="section-header">
                <h2>Sistema de Notificaciones</h2>
                <div class="section-actions">
                  <button class="btn-primary" onclick="showCreateNotificationForm()">
                    <i class="fas fa-plus"></i> Nueva Notificación
                  </button>
                  <button class="btn-secondary" onclick="loadNotificaciones()">
                    <i class="fas fa-sync"></i> Actualizar
                  </button>
                </div>
              </div>

              <!-- Lista de notificaciones -->
              <div class="notifications-list" id="notificationsList">
                <!-- Se llena dinámicamente -->
              </div>
            </div>

            <!-- Gestión de Descuentos -->
            <div id="adminDescuentosSection" class="admin-section">
              <div class="section-header">
                <h2>Gestión de Descuentos</h2>
                <div class="section-actions">
                  <button class="btn-primary" onclick="showCreateDiscountForm()">
                    <i class="fas fa-plus"></i> Nuevo Descuento
                  </button>
                  <button class="btn-secondary" onclick="loadDescuentos()">
                    <i class="fas fa-sync"></i> Actualizar
                  </button>
                </div>
              </div>

              <!-- Lista de descuentos -->
              <div class="discounts-table">
                <table>
                  <thead>
                    <tr>
                      <th>Código</th>
                      <th>Tipo</th>
                      <th>Valor</th>
                      <th>Válido Desde</th>
                      <th>Válido Hasta</th>
                      <th>Usos</th>
                      <th>Estado</th>
                      <th>Acciones</th>
                    </tr>
                  </thead>
                  <tbody id="discountsTableBody">
                    <!-- Se llena dinámicamente -->
                  </tbody>
                </table>
              </div>
            </div>

            <!-- Gestión de Servicio a Domicilio -->
            <div id="adminDomicilioSection" class="admin-section">
              <div class="section-header">
                <h2>Configuración de Servicio a Domicilio</h2>
                <div class="section-actions">
                  <button class="btn-primary" onclick="saveDeliverySettings()">
                    <i class="fas fa-save"></i> Guardar Cambios
                  </button>
                </div>
              </div>

              <div class="delivery-settings">
                <!-- Estado del servicio -->
                <div class="settings-card">
                  <div class="card-header">
                    <h3><i class="fas fa-toggle-on"></i> Estado del Servicio</h3>
                  </div>
                  <div class="card-body">
                    <div class="setting-item">
                      <div class="setting-info">
                        <label class="setting-label">Habilitar Servicio a Domicilio</label>
                        <p class="setting-description">Activa o desactiva el servicio de entrega a domicilio para todos los clientes</p>
                      </div>
                      <label class="switch">
                        <input type="checkbox" id="deliveryEnabled" checked>
                        <span class="slider"></span>
                      </label>
                    </div>
                  </div>
                </div>

                <!-- Información del Negocio -->
                <div class="settings-card">
                  <div class="card-header">
                    <h3><i class="fas fa-store"></i> Información del Negocio</h3>
                  </div>
                  <div class="card-body">
                    <div class="form-group">
                      <label class="form-label">Dirección del Negocio</label>
                      <input type="text" id="businessAddress" class="form-input" placeholder="Calle Principal #123, Col. Centro" value="Av. Cervecera 456, Col. Premium">
                    </div>
                    <div class="form-row">
                      <div class="form-group">
                        <label class="form-label">Teléfono de Contacto</label>
                        <input type="tel" id="businessPhone" class="form-input" placeholder="+52 123 456 7890" value="+52 555 123 4567">
                      </div>
                      <div class="form-group">
                        <label class="form-label">Email de Contacto</label>
                        <input type="email" id="businessEmail" class="form-input" placeholder="info@cerveza.com" value="info@cervezapremium.com">
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Costos de Envío -->
                <div class="settings-card">
                  <div class="card-header">
                    <h3><i class="fas fa-dollar-sign"></i> Costos de Envío</h3>
                  </div>
                  <div class="card-body">
                    <div class="form-row">
                      <div class="form-group">
                        <label class="form-label">Costo Base de Envío ($)</label>
                        <input type="number" id="baseShippingCost" class="form-input" step="0.01" min="0" placeholder="50.00" value="50.00">
                        <span class="form-help">Costo fijo de envío para pedidos dentro de la zona principal</span>
                      </div>
                      <div class="form-group">
                        <label class="form-label">Envío Gratis desde ($)</label>
                        <input type="number" id="freeShippingFrom" class="form-input" step="0.01" min="0" placeholder="500.00" value="500.00">
                        <span class="form-help">Monto mínimo de compra para envío gratis</span>
                      </div>
                    </div>
                    <div class="form-row">
                      <div class="form-group">
                        <label class="form-label">Costo por Km Adicional ($)</label>
                        <input type="number" id="costPerKm" class="form-input" step="0.01" min="0" placeholder="10.00" value="10.00">
                        <span class="form-help">Cargo adicional por kilómetro fuera de la zona base</span>
                      </div>
                      <div class="form-group">
                        <label class="form-label">Radio Base (Km)</label>
                        <input type="number" id="baseRadius" class="form-input" min="0" placeholder="5" value="5">
                        <span class="form-help">Radio de cobertura sin cargo adicional</span>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Tiempos de Entrega -->
                <div class="settings-card">
                  <div class="card-header">
                    <h3><i class="fas fa-clock"></i> Tiempos de Entrega</h3>
                  </div>
                  <div class="card-body">
                    <div class="form-row">
                      <div class="form-group">
                        <label class="form-label">Tiempo Estimado Mínimo (min)</label>
                        <input type="number" id="minDeliveryTime" class="form-input" min="0" placeholder="30" value="30">
                      </div>
                      <div class="form-group">
                        <label class="form-label">Tiempo Estimado Máximo (min)</label>
                        <input type="number" id="maxDeliveryTime" class="form-input" min="0" placeholder="60" value="60">
                      </div>
                    </div>
                    <div class="form-group">
                      <label class="form-label">Mensaje de Tiempo de Entrega</label>
                      <input type="text" id="deliveryTimeMessage" class="form-input" placeholder="Entrega en 30-60 minutos" value="Tu pedido llegará en 30-60 minutos">
                      <span class="form-help">Mensaje que verán los clientes al realizar un pedido</span>
                    </div>
                  </div>
                </div>

                <!-- Horarios de Servicio -->
                <div class="settings-card">
                  <div class="card-header">
                    <h3><i class="fas fa-calendar-alt"></i> Horarios de Servicio</h3>
                  </div>
                  <div class="card-body">
                    <div class="schedule-grid">
                      <div class="schedule-day">
                        <label class="checkbox-label">
                          <input type="checkbox" checked> Lunes
                        </label>
                        <div class="time-inputs">
                          <input type="time" class="form-input" value="09:00">
                          <span>a</span>
                          <input type="time" class="form-input" value="22:00">
                        </div>
                      </div>
                      <div class="schedule-day">
                        <label class="checkbox-label">
                          <input type="checkbox" checked> Martes
                        </label>
                        <div class="time-inputs">
                          <input type="time" class="form-input" value="09:00">
                          <span>a</span>
                          <input type="time" class="form-input" value="22:00">
                        </div>
                      </div>
                      <div class="schedule-day">
                        <label class="checkbox-label">
                          <input type="checkbox" checked> Miércoles
                        </label>
                        <div class="time-inputs">
                          <input type="time" class="form-input" value="09:00">
                          <span>a</span>
                          <input type="time" class="form-input" value="22:00">
                        </div>
                      </div>
                      <div class="schedule-day">
                        <label class="checkbox-label">
                          <input type="checkbox" checked> Jueves
                        </label>
                        <div class="time-inputs">
                          <input type="time" class="form-input" value="09:00">
                          <span>a</span>
                          <input type="time" class="form-input" value="22:00">
                        </div>
                      </div>
                      <div class="schedule-day">
                        <label class="checkbox-label">
                          <input type="checkbox" checked> Viernes
                        </label>
                        <div class="time-inputs">
                          <input type="time" class="form-input" value="09:00">
                          <span>a</span>
                          <input type="time" class="form-input" value="23:00">
                        </div>
                      </div>
                      <div class="schedule-day">
                        <label class="checkbox-label">
                          <input type="checkbox" checked> Sábado
                        </label>
                        <div class="time-inputs">
                          <input type="time" class="form-input" value="10:00">
                          <span>a</span>
                          <input type="time" class="form-input" value="23:00">
                        </div>
                      </div>
                      <div class="schedule-day">
                        <label class="checkbox-label">
                          <input type="checkbox" checked> Domingo
                        </label>
                        <div class="time-inputs">
                          <input type="time" class="form-input" value="10:00">
                          <span>a</span>
                          <input type="time" class="form-input" value="20:00">
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Zonas de Entrega -->
                <div class="settings-card">
                  <div class="card-header">
                    <h3><i class="fas fa-map-marked-alt"></i> Zonas de Entrega</h3>
                    <button class="btn-primary btn-small" onclick="addDeliveryZone()">
                      <i class="fas fa-plus"></i> Agregar Zona
                    </button>
                  </div>
                  <div class="card-body">
                    <div class="zones-table">
                      <table>
                        <thead>
                          <tr>
                            <th>Zona</th>
                            <th>Código Postal</th>
                            <th>Costo Adicional</th>
                            <th>Tiempo Extra (min)</th>
                            <th>Estado</th>
                            <th>Acciones</th>
                          </tr>
                        </thead>
                        <tbody id="deliveryZonesBody">
                          <tr>
                            <td>Centro</td>
                            <td>01000-01999</td>
                            <td>$0.00</td>
                            <td>0</td>
                            <td><span class="status-badge active">Activa</span></td>
                            <td>
                              <button class="btn-small" onclick="editZone(1)"><i class="fas fa-edit"></i></button>
                              <button class="btn-small btn-danger" onclick="deleteZone(1)"><i class="fas fa-trash"></i></button>
                            </td>
                          </tr>
                          <tr>
                            <td>Norte</td>
                            <td>02000-02999</td>
                            <td>$30.00</td>
                            <td>15</td>
                            <td><span class="status-badge active">Activa</span></td>
                            <td>
                              <button class="btn-small" onclick="editZone(2)"><i class="fas fa-edit"></i></button>
                              <button class="btn-small btn-danger" onclick="deleteZone(2)"><i class="fas fa-trash"></i></button>
                            </td>
                          </tr>
                          <tr>
                            <td>Sur</td>
                            <td>03000-03999</td>
                            <td>$20.00</td>
                            <td>10</td>
                            <td><span class="status-badge active">Activa</span></td>
                            <td>
                              <button class="btn-small" onclick="editZone(3)"><i class="fas fa-edit"></i></button>
                              <button class="btn-small btn-danger" onclick="deleteZone(3)"><i class="fas fa-trash"></i></button>
                            </td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                  </div>
                </div>

                <!-- Configuraciones Adicionales -->
                <div class="settings-card">
                  <div class="card-header">
                    <h3><i class="fas fa-cog"></i> Configuraciones Adicionales</h3>
                  </div>
                  <div class="card-body">
                    <div class="setting-item">
                      <div class="setting-info">
                        <label class="setting-label">Permitir Notas del Cliente</label>
                        <p class="setting-description">Los clientes pueden agregar instrucciones especiales para la entrega</p>
                      </div>
                      <label class="switch">
                        <input type="checkbox" id="allowNotes" checked>
                        <span class="slider"></span>
                      </label>
                    </div>
                    <div class="setting-item">
                      <div class="setting-info">
                        <label class="setting-label">Requerir Verificación de Edad</label>
                        <p class="setting-description">Solicitar identificación al momento de la entrega</p>
                      </div>
                      <label class="switch">
                        <input type="checkbox" id="requireAgeVerification" checked>
                        <span class="slider"></span>
                      </label>
                    </div>
                    <div class="setting-item">
                      <div class="setting-info">
                        <label class="setting-label">Rastreo en Tiempo Real</label>
                        <p class="setting-description">Permitir a los clientes rastrear su pedido en tiempo real</p>
                      </div>
                      <label class="switch">
                        <input type="checkbox" id="realTimeTracking">
                        <span class="slider"></span>
                      </label>
                    </div>
                    <div class="form-group">
                      <label class="form-label">Pedido Mínimo para Domicilio ($)</label>
                      <input type="number" id="minOrderAmount" class="form-input" step="0.01" min="0" placeholder="100.00" value="100.00">
                      <span class="form-help">Monto mínimo de compra requerido para servicio a domicilio</span>
                    </div>
                    <div class="form-group">
                      <label class="form-label">Mensaje de Bienvenida</label>
                      <textarea id="deliveryWelcomeMessage" class="form-input" rows="3" placeholder="Mensaje que verán los clientes...">¡Entregamos tu cerveza premium favorita directamente a tu puerta! Disfruta de nuestro servicio de entrega rápido y confiable.</textarea>
                    </div>
                  </div>
                </div>

                <!-- Estadísticas de Entregas -->
                <div class="settings-card">
                  <div class="card-header">
                    <h3><i class="fas fa-chart-bar"></i> Estadísticas de Entregas</h3>
                  </div>
                  <div class="card-body">
                    <div class="delivery-stats">
                      <div class="stat-box">
                        <i class="fas fa-truck"></i>
                        <h4>125</h4>
                        <p>Entregas Hoy</p>
                      </div>
                      <div class="stat-box">
                        <i class="fas fa-clock"></i>
                        <h4>38 min</h4>
                        <p>Tiempo Promedio</p>
                      </div>
                      <div class="stat-box">
                        <i class="fas fa-star"></i>
                        <h4>4.8</h4>
                        <p>Calificación</p>
                      </div>
                      <div class="stat-box">
                        <i class="fas fa-check-circle"></i>
                        <h4>98%</h4>
                        <p>Entregas Exitosas</p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Corte Diario de Ventas -->
            <div id="adminCorteDiarioSection" class="admin-section">
              <div class="section-header">
                <h2><i class="fas fa-cash-register"></i> Corte Diario de Ventas</h2>
                <div class="section-actions">
                  <input type="date" id="corteFecha" class="form-input" style="margin-right: 10px; width: 200px;">
                  <button class="btn-primary" onclick="loadCorteDiario()">
                    <i class="fas fa-sync-alt"></i> Actualizar
                  </button>
                  <button class="btn-secondary" onclick="imprimirCorteDiario()">
                    <i class="fas fa-print"></i> Imprimir
                  </button>
                </div>
              </div>

              <!-- Resumen del Día -->
              <div class="corte-resumen">
                <div class="corte-stat-card">
                  <div class="stat-icon" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                    <i class="fas fa-shopping-cart"></i>
                  </div>
                  <div class="stat-content">
                    <h3 id="corteTotalPedidos">0</h3>
                    <p>Total de Pedidos</p>
                  </div>
                </div>
                <div class="corte-stat-card">
                  <div class="stat-icon" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                    <i class="fas fa-dollar-sign"></i>
                  </div>
                  <div class="stat-content">
                    <h3 id="corteVentasTotales">$0.00</h3>
                    <p>Ventas Totales</p>
                  </div>
                </div>
                <div class="corte-stat-card">
                  <div class="stat-icon" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                    <i class="fas fa-users"></i>
                  </div>
                  <div class="stat-content">
                    <h3 id="corteClientesUnicos">0</h3>
                    <p>Clientes Únicos</p>
                  </div>
                </div>
                <div class="corte-stat-card">
                  <div class="stat-icon" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);">
                    <i class="fas fa-receipt"></i>
                  </div>
                  <div class="stat-content">
                    <h3 id="corteTicketPromedio">$0.00</h3>
                    <p>Ticket Promedio</p>
                  </div>
                </div>
              </div>

              <!-- Estados de Pedidos -->
              <div class="corte-estados">
                <h3><i class="fas fa-list"></i> Estados de Pedidos</h3>
                <div class="estados-grid">
                  <div class="estado-badge pendiente">
                    <span class="estado-label">Pendientes</span>
                    <span class="estado-count" id="cortePendientes">0</span>
                  </div>
                  <div class="estado-badge confirmado">
                    <span class="estado-label">Confirmados</span>
                    <span class="estado-count" id="corteConfirmados">0</span>
                  </div>
                  <div class="estado-badge en_preparacion">
                    <span class="estado-label">En Preparación</span>
                    <span class="estado-count" id="corteEnPreparacion">0</span>
                  </div>
                  <div class="estado-badge enviado">
                    <span class="estado-label">Enviados</span>
                    <span class="estado-count" id="corteEnviados">0</span>
                  </div>
                  <div class="estado-badge entregado">
                    <span class="estado-label">Entregados</span>
                    <span class="estado-count" id="corteEntregados">0</span>
                  </div>
                  <div class="estado-badge cancelado">
                    <span class="estado-label">Cancelados</span>
                    <span class="estado-count" id="corteCancelados">0</span>
                  </div>
                </div>
              </div>

              <!-- Ventas por Hora -->
              <div class="corte-ventas-hora">
                <h3><i class="fas fa-chart-line"></i> Ventas por Hora</h3>
                <div id="ventasPorHoraChart" class="ventas-chart">
                  <!-- Se llena dinámicamente -->
                </div>
              </div>

              <!-- Productos Vendidos -->
              <div class="corte-productos">
                <h3><i class="fas fa-beer"></i> Productos Vendidos</h3>
                <div class="table-container">
                  <table class="data-table">
                    <thead>
                      <tr>
                        <th>Producto</th>
                        <th>Cantidad</th>
                        <th>Veces Pedido</th>
                        <th>Ingresos</th>
                      </tr>
                    </thead>
                    <tbody id="corteProductosTableBody">
                      <!-- Se llena dinámicamente -->
                    </tbody>
                  </table>
                </div>
              </div>

              <!-- Métodos de Pago -->
              <div class="corte-metodos-pago">
                <h3><i class="fas fa-credit-card"></i> Métodos de Pago</h3>
                <div id="metodosPagoContainer" class="metodos-grid">
                  <!-- Se llena dinámicamente -->
                </div>
              </div>

              <!-- Lista de Pedidos del Día -->
              <div class="corte-pedidos">
                <h3><i class="fas fa-list-alt"></i> Pedidos del Día</h3>
                <div class="table-container">
                  <table class="data-table">
                    <thead>
                      <tr>
                        <th>ID</th>
                        <th>Cliente</th>
                        <th>Hora</th>
                        <th>Items</th>
                        <th>Total</th>
                        <th>Estado</th>
                        <th>Método Pago</th>
                      </tr>
                    </thead>
                    <tbody id="cortePedidosTableBody">
                      <!-- Se llena dinámicamente -->
                    </tbody>
                  </table>
                </div>
              </div>
            </div>

            <!-- Rutas de Repartidores -->
            <div id="adminRepartidoresSection" class="admin-section">
              <div class="section-header">
                <h2><i class="fas fa-route"></i> Rutas de Repartidores</h2>
                <div class="section-actions">
                  <button class="btn-primary" onclick="showAddRepartidorForm()" style="margin-right: 10px;">
                    <i class="fas fa-plus"></i> Agregar Repartidor
                  </button>
                  <select id="repartidoresHoras" class="form-input" style="margin-right: 10px; width: 200px;" onchange="loadRepartidoresRutas()">
                    <option value="1">Última hora</option>
                    <option value="6">Últimas 6 horas</option>
                    <option value="24" selected>Últimas 24 horas</option>
                    <option value="48">Últimas 48 horas</option>
                  </select>
                  <button class="btn-secondary" onclick="loadRepartidoresRutas()">
                    <i class="fas fa-sync-alt"></i> Actualizar
                  </button>
                </div>
              </div>

              <div id="repartidoresRutasContainer" class="repartidores-rutas-container">
                <div class="loading-state">
                  <i class="fas fa-spinner fa-spin"></i>
                  <p>Cargando rutas de repartidores...</p>
                </div>
              </div>
            </div>
          </main>
        </div>
      </section>

      <!-- Modal para Agregar/Editar Cerveza -->
      <div id="beerModal" class="modal">
        <div class="modal-content">
          <div class="modal-header">
            <h2 id="beerModalTitle">Nueva Cerveza</h2>
            <button class="modal-close" onclick="closeBeerModal()">
              <i class="fas fa-times"></i>
            </button>
          </div>
          
          <form id="beerForm" class="modal-form">
            <div class="form-row">
              <div class="form-group">
                <label for="beerName" class="form-label">Nombre de la Cerveza</label>
                <input type="text" id="beerName" class="form-input" placeholder="Ej: Golden Sunset IPA" required>
              </div>
              
              <div class="form-group">
                <label for="beerStyle" class="form-label">Estilo</label>
                <input type="text" id="beerStyle" class="form-input" placeholder="Ej: India Pale Ale" required>
              </div>
            </div>

            <div class="form-group">
              <label for="beerDescription" class="form-label">Descripción</label>
              <textarea id="beerDescription" class="form-input" rows="3" placeholder="Describe el sabor, aroma y características de la cerveza..."></textarea>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="beerPrice" class="form-label">Precio ($)</label>
                <input type="number" id="beerPrice" class="form-input" step="0.01" min="0" placeholder="89.99" required>
              </div>
              
              <div class="form-group">
                <label for="beerPoints" class="form-label">Puntos Ganados</label>
                <input type="number" id="beerPoints" class="form-input" min="0" placeholder="90" required>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="beerStock" class="form-label">Stock Disponible</label>
                <input type="number" id="beerStock" class="form-input" min="0" placeholder="50" required>
              </div>
              
              <div class="form-group">
                <label for="beerCategory" class="form-label">Categoría</label>
                <select id="beerCategory" class="form-input" required>
                  <option value="">Seleccionar categoría</option>
                  <option value="1">India Pale Ale</option>
                  <option value="2">Imperial Stout</option>
                  <option value="3">Weissbier</option>
                  <option value="4">Red Ale</option>
                  <option value="5">Premium Lager</option>
                  <option value="6">Smoked Porter</option>
                  <option value="7">Pale Ale</option>
                  <option value="8">Wheat Beer</option>
                </select>
              </div>
            </div>

            <div class="form-group">
              <label for="beerImage" class="form-label">URL de la Imagen</label>
              <input type="url" id="beerImage" class="form-input" placeholder="https://ejemplo.com/imagen.jpg">
              <small class="form-help">Puedes usar URLs de Unsplash o subir una imagen</small>
            </div>

            <div class="form-group">
              <label class="checkbox-label">
                <input type="checkbox" id="beerActive" checked>
                <span>Cerveza activa (disponible para venta)</span>
              </label>
            </div>

            <div class="modal-actions">
              <button type="button" class="btn-secondary" onclick="closeBeerModal()">Cancelar</button>
              <button type="submit" class="btn-primary">
                <span class="button-text">Guardar Cerveza</span>
                <span class="loading-spinner" style="display: none;"></span>
              </button>
            </div>
          </form>
        </div>
      </div>

      <!-- Modal para Agregar/Editar Repartidor -->
      <div id="repartidorModal" class="modal">
        <div class="modal-content">
          <div class="modal-header">
            <h2 id="repartidorModalTitle">Nuevo Repartidor</h2>
            <button class="modal-close" onclick="closeRepartidorModal()">
              <i class="fas fa-times"></i>
            </button>
          </div>
          
          <form id="repartidorForm" class="modal-form">
            <div class="form-row">
              <div class="form-group">
                <label for="repartidorNombre" class="form-label">Nombre Completo</label>
                <input type="text" id="repartidorNombre" class="form-input" placeholder="Ej: Juan Pérez" required>
              </div>
              
              <div class="form-group">
                <label for="repartidorTelefono" class="form-label">Teléfono</label>
                <input type="tel" id="repartidorTelefono" class="form-input" placeholder="Ej: 5551234567" required>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="repartidorEmail" class="form-label">Email (Opcional)</label>
                <input type="email" id="repartidorEmail" class="form-input" placeholder="juan.perez@ejemplo.com">
              </div>
              
              <div class="form-group">
                <label for="repartidorVehiculo" class="form-label">Vehículo</label>
                <select id="repartidorVehiculo" class="form-input" required>
                  <option value="Moto">Moto</option>
                  <option value="Bicicleta">Bicicleta</option>
                  <option value="Automóvil">Automóvil</option>
                  <option value="Camioneta">Camioneta</option>
                </select>
              </div>
            </div>

            <div class="form-group">
              <label for="repartidorPlaca" class="form-label">Placa/Número de Vehículo</label>
              <input type="text" id="repartidorPlaca" class="form-input" placeholder="Ej: ABC-123" maxlength="20">
            </div>

            <div class="form-group">
              <label class="checkbox-label">
                <input type="checkbox" id="repartidorActivo" checked>
                <span>Repartidor activo (disponible para asignar pedidos)</span>
              </label>
            </div>

            <div class="modal-actions">
              <button type="button" class="btn-secondary" onclick="closeRepartidorModal()">Cancelar</button>
              <button type="submit" class="btn-primary">
                <span class="button-text">Guardar Repartidor</span>
                <span class="loading-spinner" style="display: none;"></span>
              </button>
            </div>
          </form>
        </div>
      </div>

      <!-- Modal para Gestión de Stock -->
      <div id="stockModal" class="modal">
        <div class="modal-content">
          <div class="modal-header">
            <h2>Gestión de Stock</h2>
            <button class="modal-close" onclick="closeStockModal()">
              <i class="fas fa-times"></i>
            </button>
          </div>
          
          <div class="stock-content">
            <div class="stock-beer-info">
              <img id="stockBeerImage" src="" alt="" class="stock-beer-img">
              <div class="stock-beer-details">
                <h3 id="stockBeerName"></h3>
                <p id="stockBeerStyle"></p>
                <p>Stock actual: <strong id="currentStock">0</strong></p>
              </div>
            </div>

            <form id="stockForm" class="modal-form">
              <div class="form-group">
                <label for="stockAction" class="form-label">Acción</label>
                <select id="stockAction" class="form-input" required>
                  <option value="">Seleccionar acción</option>
                  <option value="add">Agregar Stock</option>
                  <option value="remove">Reducir Stock</option>
                  <option value="set">Establecer Stock</option>
                </select>
              </div>

              <div class="form-group">
                <label for="stockQuantity" class="form-label">Cantidad</label>
                <input type="number" id="stockQuantity" class="form-input" min="0" required>
              </div>

              <div class="form-group">
                <label for="stockReason" class="form-label">Motivo</label>
                <select id="stockReason" class="form-input">
                  <option value="compra">Compra de inventario</option>
                  <option value="devolucion">Devolución de cliente</option>
                  <option value="perdida">Pérdida/daño</option>
                  <option value="ajuste">Ajuste manual</option>
                  <option value="venta">Venta realizada</option>
                </select>
              </div>

              <div class="modal-actions">
                <button type="button" class="btn-secondary" onclick="closeStockModal()">Cancelar</button>
                <button type="submit" class="btn-primary">
                  <span class="button-text">Actualizar Stock</span>
                  <span class="loading-spinner" style="display: none;"></span>
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>

      <!-- Modal para Crear Notificación -->
      <div id="notificationModal" class="modal">
        <div class="modal-content">
          <div class="modal-header">
            <h2>Nueva Notificación</h2>
            <button class="modal-close" onclick="closeNotificationModal()">
              <i class="fas fa-times"></i>
            </button>
          </div>
          
          <form id="notificationForm" class="modal-form">
            <div class="form-group">
              <label for="notificationType" class="form-label">Tipo de Notificación</label>
              <select id="notificationType" class="form-input" required>
                <option value="stock_bajo">Stock Bajo</option>
                <option value="nuevo_pedido">Nuevo Pedido</option>
                <option value="recordatorio">Recordatorio</option>
                <option value="sistema">Sistema</option>
              </select>
            </div>

            <div class="form-group">
              <label for="notificationTitle" class="form-label">Título</label>
              <input type="text" id="notificationTitle" class="form-input" placeholder="Ej: Stock bajo en IPA" required>
            </div>

            <div class="form-group">
              <label for="notificationMessage" class="form-label">Mensaje</label>
              <textarea id="notificationMessage" class="form-input" rows="3" placeholder="Descripción detallada de la notificación..." required></textarea>
            </div>

            <div class="form-group">
              <label for="notificationUser" class="form-label">Usuario Destinatario</label>
              <select id="notificationUser" class="form-input">
                <option value="">Todos los usuarios</option>
                <!-- Se llena dinámicamente -->
              </select>
            </div>

            <div class="modal-actions">
              <button type="button" class="btn-secondary" onclick="closeNotificationModal()">Cancelar</button>
              <button type="submit" class="btn-primary">
                <span class="button-text">Crear Notificación</span>
                <span class="loading-spinner" style="display: none;"></span>
              </button>
            </div>
          </form>
        </div>
      </div>

      <!-- Modal para Crear Descuento -->
      <div id="discountModal" class="modal">
        <div class="modal-content">
          <div class="modal-header">
            <h2>Nuevo Descuento</h2>
            <button class="modal-close" onclick="closeDiscountModal()">
              <i class="fas fa-times"></i>
            </button>
          </div>
          
          <form id="discountForm" class="modal-form">
            <div class="form-row">
              <div class="form-group">
                <label for="discountCode" class="form-label">Código de Descuento</label>
                <input type="text" id="discountCode" class="form-input" placeholder="Ej: VERANO2024" required>
              </div>
              
              <div class="form-group">
                <label for="discountType" class="form-label">Tipo</label>
                <select id="discountType" class="form-input" required>
                  <option value="porcentaje">Porcentaje (%)</option>
                  <option value="cantidad_fija">Cantidad Fija ($)</option>
                </select>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="discountValue" class="form-label">Valor</label>
                <input type="number" id="discountValue" class="form-input" step="0.01" min="0" placeholder="10" required>
              </div>
              
              <div class="form-group">
                <label for="discountMaxUses" class="form-label">Usos Máximos</label>
                <input type="number" id="discountMaxUses" class="form-input" min="1" placeholder="100">
              </div>
            </div>

            <div class="form-group">
              <label for="discountDescription" class="form-label">Descripción</label>
              <textarea id="discountDescription" class="form-input" rows="2" placeholder="Descripción del descuento..."></textarea>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="discountStartDate" class="form-label">Fecha de Inicio</label>
                <input type="datetime-local" id="discountStartDate" class="form-input" required>
              </div>
              
              <div class="form-group">
                <label for="discountEndDate" class="form-label">Fecha de Fin</label>
                <input type="datetime-local" id="discountEndDate" class="form-input" required>
              </div>
            </div>

            <div class="form-group">
              <label for="discountApplicable" class="form-label">Aplicable a</label>
              <select id="discountApplicable" class="form-input" required>
                <option value="todos">Todos los productos</option>
                <option value="categoria">Categoría específica</option>
                <option value="producto">Producto específico</option>
              </select>
            </div>

            <div class="form-group" id="categoryGroup" style="display: none;">
              <label for="discountCategory" class="form-label">Categoría</label>
              <select id="discountCategory" class="form-input">
                <option value="">Seleccionar categoría</option>
                <option value="1">India Pale Ale</option>
                <option value="2">Imperial Stout</option>
                <option value="3">Weissbier</option>
                <option value="4">Red Ale</option>
                <option value="5">Premium Lager</option>
                <option value="6">Smoked Porter</option>
                <option value="7">Pale Ale</option>
                <option value="8">Wheat Beer</option>
              </select>
            </div>

            <div class="form-group" id="productGroup" style="display: none;">
              <label for="discountProduct" class="form-label">Producto</label>
              <select id="discountProduct" class="form-input">
                <option value="">Seleccionar producto</option>
                <!-- Se llena dinámicamente -->
              </select>
            </div>

            <div class="modal-actions">
              <button type="button" class="btn-secondary" onclick="closeDiscountModal()">Cancelar</button>
              <button type="submit" class="btn-primary">
                <span class="button-text">Crear Descuento</span>
                <span class="loading-spinner" style="display: none;"></span>
              </button>
            </div>
          </form>
        </div>
      </div>

        <!-- Vista de Registro -->
      <section id="signupView" class="view">
        <div class="login-container">
          <button class="back-btn" id="backToLogin">
                    <i class="fas fa-arrow-left"></i> Volver al Login
          </button>
          
          <div class="logo-section">
                    <div class="beer-icon">
                        <i class="fas fa-beer"></i>
                    </div>
            <h1 class="brand-title">Crear Cuenta</h1>
                    <p class="brand-subtitle">Únete a nuestra comunidad cervecera</p>
          </div>

                <form id="signupForm" class="form-section">
          <div class="progress-bar">
                        <div class="progress-step active">1</div>
                        <div class="progress-step">2</div>
                        <div class="progress-step">3</div>
                        <div class="progress-step">4</div>
          </div>

            <div class="form-steps">
                        <!-- Paso 0: Verificación de Identidad -->
                        <div class="form-step active" id="step0">
                            <div class="form-group" style="text-align: center; margin-bottom: 20px;">
                                <div style="background: #e3f2fd; padding: 20px; border-radius: 12px; border: 2px solid #1976d2; margin-bottom: 20px;">
                                    <i class="fas fa-id-card" style="font-size: 48px; color: #1976d2; margin-bottom: 10px;"></i>
                                    <h3 style="color: #1976d2; margin: 10px 0;">Verificación de Identidad</h3>
                                    <p style="font-size: 14px; color: #555; margin: 10px 0;">
                                        Para garantizar que eres mayor de edad, necesitamos verificar tu identidad con una credencial oficial.
                                    </p>
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="form-label" for="idType">Tipo de Identificación</label>
                                <select id="idType" name="idType" class="form-input" required style="cursor: pointer;">
                                    <option value="">Selecciona un tipo de identificación</option>
                                    <option value="INE">INE/IFE (Credencial de Elector)</option>
                                    <option value="Pasaporte">Pasaporte</option>
                                    <option value="Licencia">Licencia de Conducir</option>
                                    <option value="Cedula">Cédula Profesional</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label class="form-label" for="idNumber">Número de Identificación</label>
                                <input 
                                    type="text" 
                                    id="idNumber" 
                                    name="idNumber" 
                                    class="form-input" 
                                    placeholder="Ingresa el número de tu identificación"
                                    required
                                    minlength="5"
                                    maxlength="20"
                                    style="text-transform: uppercase;"
                                />
                                <span class="validation-msg" id="idValidation" style="color:#b71c1c; font-size:12px; display:none;"></span>
                            </div>

                            <div class="form-group">
                                <label class="form-label">
                                    <i class="fas fa-camera"></i> Foto de tu Identificación (Frente)
                                </label>
                                <div class="file-upload-wrapper">
                                    <input 
                                        type="file" 
                                        id="idPhotoFront" 
                                        name="idPhotoFront" 
                                        accept="image/jpeg,image/png,image/jpg"
                                        required
                                        style="display: none;"
                                    />
                                    <label for="idPhotoFront" class="file-upload-label">
                                        <i class="fas fa-cloud-upload-alt"></i>
                                        <span id="frontFileName">Seleccionar archivo</span>
                                    </label>
                                    <div id="frontPreview" class="image-preview" style="display: none;">
                                        <img id="frontPreviewImg" src="" alt="Vista previa">
                                        <button type="button" class="remove-image" id="removeFront">
                                            <i class="fas fa-times"></i>
                                        </button>
                                    </div>
                                </div>
                                <small style="color: #666; font-size: 12px; display: block; margin-top: 5px;">
                                    <i class="fas fa-info-circle"></i> Formatos aceptados: JPG, PNG. Máximo 5MB
                                </small>
                            </div>

                            <div class="form-group">
                                <label class="form-label">
                                    <i class="fas fa-camera"></i> Foto de tu Identificación (Reverso)
                                </label>
                                <div class="file-upload-wrapper">
                                    <input 
                                        type="file" 
                                        id="idPhotoBack" 
                                        name="idPhotoBack" 
                                        accept="image/jpeg,image/png,image/jpg"
                                        required
                                        style="display: none;"
                                    />
                                    <label for="idPhotoBack" class="file-upload-label">
                                        <i class="fas fa-cloud-upload-alt"></i>
                                        <span id="backFileName">Seleccionar archivo</span>
                                    </label>
                                    <div id="backPreview" class="image-preview" style="display: none;">
                                        <img id="backPreviewImg" src="" alt="Vista previa">
                                        <button type="button" class="remove-image" id="removeBack">
                                            <i class="fas fa-times"></i>
                                        </button>
                                    </div>
                                </div>
                                <small style="color: #666; font-size: 12px; display: block; margin-top: 5px;">
                                    <i class="fas fa-info-circle"></i> Formatos aceptados: JPG, PNG. Máximo 5MB
                                </small>
                            </div>

                            <div style="background: #fff3cd; padding: 15px; border-radius: 8px; border: 1px solid #ffc107; margin: 20px 0;">
                                <p style="font-size: 13px; color: #856404; margin: 0; line-height: 1.6;">
                                    <i class="fas fa-shield-alt"></i> 
                                    <strong>Tu privacidad es importante:</strong> Tus documentos serán utilizados únicamente para verificar tu edad y serán almacenados de forma segura y encriptada. No compartiremos tu información con terceros.
                                </p>
                            </div>

                            <div class="step-buttons">
                                <button type="button" class="step-btn next" id="nextToStep1" disabled>Siguiente</button>
                            </div>
                        </div>

                        <!-- Paso 1: Datos Personales -->
                        <div class="form-step" id="step1">
                <div class="form-group">
                  <label class="form-label" for="signupName">Nombre Completo</label>
                  <input 
                    type="text" 
                    id="signupName" 
                    name="name" 
                    class="form-input" 
                    placeholder="Tu nombre completo"
                    required
                                    minlength="3"
                                    maxlength="100"
                                    pattern="^[a-zA-ZáéíóúÁÉÍÓÚñÑüÜ\s]+$"
                                    title="Solo se permiten letras y espacios"
                  />
                                <span class="validation-msg" id="nameValidation" style="color:#b71c1c; font-size:12px; display:none;"></span>
                </div>

                <div class="form-group">
                  <label class="form-label" for="signupEmail">Correo Electrónico</label>
                  <input 
                    type="email" 
                    id="signupEmail" 
                    name="email" 
                    class="form-input" 
                                    placeholder="tu&#64;email.com"
                    required
                                    pattern="^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$"
                                    title="Ingresa un correo válido"
                                />
                                <span class="validation-msg" id="emailValidation" style="color:#b71c1c; font-size:12px; display:none;"></span>
                </div>

                <div class="step-buttons">
                                <button type="button" class="step-btn prev" id="backToStep0">Anterior</button>
                  <button type="button" class="step-btn next" id="nextToStep2">Siguiente</button>
                </div>
              </div>

                        <!-- Paso 2: Contraseñas -->
                        <div class="form-step" id="step2">
                <div class="form-group">
                  <label class="form-label" for="signupPassword">Contraseña</label>
                  <input 
                    type="password" 
                    id="signupPassword" 
                    name="password" 
                    class="form-input" 
                    placeholder="••••••••"
                    required
                                    minlength="8"
                                    maxlength="128"
                                    autocomplete="new-password"
                  />
                                <span class="password-toggle" id="toggleSignupPassword">
                    <i class="fas fa-eye"></i>
                  </span>
                                <div class="password-strength" id="passwordStrength" style="margin-top: 8px; display: none;">
                                    <div class="strength-bar">
                                        <div class="strength-bar-fill" id="strengthBarFill"></div>
                                    </div>
                                    <span class="strength-text" id="strengthText"></span>
                                </div>
                                <ul class="password-requirements" style="margin-top: 10px; font-size: 12px; color: #666; list-style: none; padding: 0;">
                                    <li id="req-length"><i class="fas fa-circle" style="font-size: 6px; margin-right: 8px;"></i>Mínimo 8 caracteres</li>
                                    <li id="req-uppercase"><i class="fas fa-circle" style="font-size: 6px; margin-right: 8px;"></i>Una letra mayúscula</li>
                                    <li id="req-lowercase"><i class="fas fa-circle" style="font-size: 6px; margin-right: 8px;"></i>Una letra minúscula</li>
                                    <li id="req-number"><i class="fas fa-circle" style="font-size: 6px; margin-right: 8px;"></i>Un número</li>
                                    <li id="req-special"><i class="fas fa-circle" style="font-size: 6px; margin-right: 8px;"></i>Un carácter especial (&#64;$!%*?&)</li>
                                </ul>
                </div>

                <div class="form-group">
                  <label class="form-label" for="signupConfirmPassword">Confirmar Contraseña</label>
                  <input 
                    type="password" 
                    id="signupConfirmPassword" 
                    name="confirmPassword" 
                    class="form-input" 
                    placeholder="••••••••"
                    required
                                    autocomplete="new-password"
                  />
                                <span class="password-toggle" id="toggleConfirmPassword">
                                    <i class="fas fa-eye"></i>
                                </span>
                                <span class="validation-msg" id="passwordMatchValidation" style="color:#b71c1c; font-size:12px; display:none; margin-top: 5px;"></span>
                </div>

                            <div class="step-buttons">
                                <button type="button" class="step-btn prev" id="backToStep1">Anterior</button>
                                <button type="button" class="step-btn next" id="nextToStep3" disabled>Siguiente</button>
                            </div>
                        </div>

                        <!-- Paso 3: Información Adicional -->
                        <div class="form-step" id="step3">
                <div class="form-group">
                                <label class="form-label" for="signupAge">Fecha de Nacimiento</label>
                  <input 
                                    type="date" 
                    id="signupAge" 
                    name="age" 
                    class="form-input" 
                    required
                                    min="1900-01-01"
                  />
                                <span id="ageValidationMsg" style="color:#b71c1c; font-size:13px; display:none; margin-top: 5px; font-weight: 600;">
                                    <i class="fas fa-exclamation-triangle"></i> Debes ser mayor de 18 años para registrarte.
                                </span>
                </div>

                <div class="form-group">
                                <label class="form-label" for="signupPhone">Teléfono</label>
                    <input 
                                    type="tel" 
                                    id="signupPhone" 
                                    name="phone" 
                                    class="form-input" 
                                    placeholder="+52 123 456 7890"
                                    required
                                    pattern="^[\+]?[(]?[0-9]{1,4}[)]?[-\s\.]?[(]?[0-9]{1,4}[)]?[-\s\.]?[0-9]{1,9}$"
                                    title="Ingresa un número de teléfono válido"
                                    minlength="10"
                                    maxlength="15"
                                />
                                <span class="validation-msg" id="phoneValidation" style="color:#b71c1c; font-size:12px; display:none;"></span>
                </div>
                
                <div class="form-group">
                                <label class="form-label" for="signupAddress">Dirección</label>
                                <textarea 
                                    id="signupAddress" 
                                    name="address" 
                                    class="form-input" 
                                    placeholder="Calle, número, colonia, ciudad, estado, código postal"
                                    rows="2"
                                    required
                                    minlength="10"
                                    maxlength="200"
                                ></textarea>
                                <span class="validation-msg" id="addressValidation" style="color:#b71c1c; font-size:12px; display:none;"></span>
                </div>

                            <div class="form-group" style="margin-top: 15px; background: #fff3cd; padding: 12px; border-radius: 8px; border: 1px solid #ffc107;">
                                <label class="form-label" style="display: flex; align-items: flex-start; cursor: pointer; margin: 0;">
                                    <input type="checkbox" id="confirmLegalAge" name="confirmLegalAge" required style="margin-right: 10px; margin-top: 3px; cursor: pointer; width: 18px; height: 18px;">
                                    <span style="font-size: 13px; line-height: 1.5;">
                                        <strong>Declaro bajo protesta de decir verdad que soy mayor de 18 años</strong> y acepto la <a href="#" style="color: #1976d2; text-decoration: underline;">política de venta responsable de alcohol</a>. Entiendo que proporcionar información falsa puede resultar en la cancelación de mi cuenta.
                                    </span>
                  </label>
                </div>

                            <div class="form-group" style="margin-top: 10px;">
                                <label class="form-label" style="display: flex; align-items: flex-start; cursor: pointer; margin: 0;">
                                    <input type="checkbox" id="acceptTerms" name="acceptTerms" required style="margin-right: 10px; margin-top: 3px; cursor: pointer; width: 18px; height: 18px;">
                                    <span style="font-size: 13px;">
                                        Acepto los <a href="#" style="color: #1976d2; text-decoration: underline;">términos y condiciones</a> y la <a href="#" style="color: #1976d2; text-decoration: underline;">política de privacidad</a>.
                                    </span>
                  </label>
                </div>

                <div class="step-buttons">
                                <button type="button" class="step-btn prev" id="backToStep2">Anterior</button>
                                <button type="submit" class="step-btn next" id="submitSignup" disabled>Crear Cuenta</button>
                </div>
              </div>
            </div>
          </form>
                <div style="margin-top: 16px; color: #b71c1c; font-size: 13px; text-align: center;">
                    <i class="fas fa-ban"></i>
                    La venta de alcohol a menores de edad está prohibida. Nos reservamos el derecho de solicitar documentación para verificar tu edad.
          </div>
            </div>
        </section>

        <!-- Vista del Dashboard -->
      <section id="dashboardView" class="view">
        <div class="dashboard-content">
          <div class="dashboard-header">
            <div class="user-info">
                      <div class="user-avatar">
                        {{currentUser?.nombre_completo ? (currentUser!.nombre_completo.split(' ')[0].charAt(0) + ((currentUser!.nombre_completo.split(' ')[1] || '').charAt(0) || '')) : 'U'}}
                      </div>
              <div>
                            <h3>{{currentUser?.nombre_completo || 'Usuario'}}</h3>
                            <p>{{currentUser?.email || 'usuario@ejemplo.com'}}</p>
              </div>
            </div>
          </div>
          
                <!-- Tarjeta de puntos -->
          <div class="points-card">
            <div class="points-card-header">
                        <div class="points-card-title">CervezaPoints</div>
              <div class="points-card-icon">
                            <i class="fas fa-star"></i>
              </div>
            </div>
                    <div class="points-value" id="pointsBalance">1,250</div>
            <div class="points-label">Puntos acumulados</div>
            <div class="points-progress">
                        <div class="points-progress-bar" style="width: 62.5%"></div>
            </div>
                    <div class="points-next-level">Siguiente nivel: 2,000 puntos</div>
            <div class="points-benefits">
              <div class="points-benefit">
                <div class="benefit-icon">
                  <i class="fas fa-gift"></i>
                </div>
                            <div class="benefit-text">Recompensas exclusivas</div>
              </div>
              <div class="points-benefit">
                <div class="benefit-icon">
                                <i class="fas fa-truck"></i>
                </div>
                            <div class="benefit-text">Envío gratis</div>
              </div>
              <div class="points-benefit">
                <div class="benefit-icon">
                                <i class="fas fa-percentage"></i>
                </div>
                            <div class="benefit-text">Descuentos especiales</div>
              </div>
            </div>
          </div>

                <h1 class="brand-title">Bienvenido a Cerveza Premium</h1>
                <p class="brand-subtitle">Tu experiencia cervecera personalizada</p>
          
          <app-dashboard-menu
            [currentUser]="currentUser"
            [cartCount]="getCartCount()"
            [favoritesCount]="getFavoritesCount()"
            [notificationsCount]="getNotificationsCount()"
            (orderDeliveryClick)="onOrderDelivery()"
            (showCatalogClick)="onShowCatalog()"
            (showCartClick)="onShowCart()"
            (showOrdersClick)="onShowOrders()"
            (showProfileClick)="onShowProfile()"
            (showFavoritesClick)="onShowFavorites()"
            (showPointsHistoryClick)="onShowPointsHistory()"
            (showAddressesClick)="onShowAddresses()"
            (showNotificationsClick)="onShowNotifications()"
            (showHelpClick)="onShowHelp()"
            (showSettingsClick)="onShowSettings()"
            (showPromotionsClick)="onShowPromotions()"
            (showRecommendationsClick)="onShowRecommendations()"
            (showAdminPanelClick)="onShowAdminPanel()"
            (logoutClick)="onLogout()">
          </app-dashboard-menu>
            </div>
        </section>

        <!-- Vista del Catálogo -->
        <section id="catalogView" class="view">
            <div class="catalog-content">
                <div class="catalog-header">
                    <button class="back-btn" id="backToDashboard">
                        <i class="fas fa-arrow-left"></i> Volver
                    </button>
                    <div class="catalog-title-container">
                        <h1 class="catalog-title">
                            <i class="fas fa-beer"></i> Cervezas Mexicanas Premium
                        </h1>
                        <p class="catalog-subtitle">Descubre nuestra selección artesanal</p>
                    </div>
                    <button class="cart-header-btn" id="goToCart">
                        <i class="fas fa-shopping-cart"></i>
                        <span>Carrito</span>
                        <span class="cart-badge" id="catalogCartBadge" style="display: none;">0</span>
                    </button>
                </div>

                <div class="catalog-hero glass-card">
                    <div class="catalog-hero-copy">
                        <span class="pill pill-accent"><i class="fas fa-crown"></i> Selección 2025</span>
                        <h2>Entrega cervezas frías en menos de 45 minutos</h2>
                        <p>
                            Curamos etiquetas mexicanas con altos estándares sensoriales. Combina filtros avanzados con
                            entregas inteligentes y conoce exactamente cuántos puntos ganarás en cada compra.
                        </p>
                        <div class="hero-actions">
                            <button class="btn-premium hero-primary" id="heroOrderDelivery">
                                <i class="fas fa-bolt"></i> Ordenar entrega express
                            </button>
                            <button class="btn-outline hero-secondary" id="heroViewFavorites">
                                <i class="fas fa-heart"></i> Ver favoritos
                            </button>
                        </div>
                    </div>
                    <div class="catalog-hero-stats">
                        <div class="hero-stat">
                            <span class="hero-stat-value" id="heroProducts">00</span>
                            <span class="hero-stat-label">Referencias activas</span>
                        </div>
                        <div class="hero-stat">
                            <span class="hero-stat-value" id="heroPremium">00</span>
                            <span class="hero-stat-label">Etiquetas premium</span>
                        </div>
                        <div class="hero-stat">
                            <span class="hero-stat-value" id="heroCraft">00</span>
                            <span class="hero-stat-label">Cervecerías artesanales</span>
                        </div>
                    </div>
                </div>

                <div class="catalog-quick-filters" id="quickFilters">
                    <span class="quick-filters-label">
                        <i class="fas fa-wand-magic-sparkles"></i> Filtros rápidos
                    </span>
                    <div class="quick-filters-group">
                        <button class="quick-filter" data-filter-id="featured" data-select="filterCategory" data-value="featured">
                            <i class="fas fa-star"></i> Destacadas
                        </button>
                        <button class="quick-filter" data-filter-id="premium" data-select="filterCategory" data-value="premium">
                            <i class="fas fa-gem"></i> Premium $100+
                        </button>
                        <button class="quick-filter" data-filter-id="artesanal" data-select="filterCategory" data-value="artesanal">
                            <i class="fas fa-leaf"></i> Artesanales
                        </button>
                        <button class="quick-filter" data-filter-id="lager" data-select="filterStyle" data-value="Lager">
                            <i class="fas fa-temperature-low"></i> Lager refrescante
                        </button>
                        <button class="quick-filter" data-filter-id="ipa" data-select="filterStyle" data-value="IPA">
                            <i class="fas fa-fire"></i> IPAs intensas
                        </button>
                        <button class="quick-filter" data-filter-id="rating" data-select="filterRating" data-value="4.5+">
                            <i class="fas fa-medal"></i> 4.5★ o más
                        </button>
                        <button class="quick-filter" data-filter-id="budget" data-select="filterPrice" data-value="0-50">
                            <i class="fas fa-wallet"></i> Menos de $50
                        </button>
                    </div>
                </div>

                <div class="catalog-insights glass-card" id="catalogInsights">
                    <div class="insight-card">
                        <span class="insight-label">Promedio de rating</span>
                        <span class="insight-value" id="insightRating">0.0 ★</span>
                        <small class="insight-hint">Actualizado en tiempo real</small>
                    </div>
                    <div class="insight-card">
                        <span class="insight-label">Ticket estimado</span>
                        <span class="insight-value" id="insightPrice">$0.00</span>
                        <small class="insight-hint">Basado en tu búsqueda</small>
                    </div>
                    <div class="insight-card">
                        <span class="insight-label">Inventario disponible</span>
                        <span class="insight-value" id="insightStock">0</span>
                        <small class="insight-hint">Botellas en stock</small>
                    </div>
                    <div class="insight-card">
                        <span class="insight-label">Estilo más buscado</span>
                        <span class="insight-value" id="insightStyle">—</span>
                        <small class="insight-hint">Se actualiza con cada filtro</small>
                    </div>
                </div>
                
                <div class="search-bar">
                    <div class="search-container">
                        <i class="fas fa-search search-icon-left"></i>
                        <input type="text" class="search-input" id="searchBeer" placeholder="Buscar cervezas, estilos, sabores..." aria-label="Buscar cervezas">
                        <button class="search-clear-btn" id="clearSearch" style="display: none;" aria-label="Limpiar búsqueda">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    
                    <div class="catalog-controls">
                        <div class="filters-container">
                            <select class="filter-select" id="filterStyle">
                                <option value="">🍺 Todos los estilos</option>
                                <option value="Lager">Lager</option>
                                <option value="Vienna Lager">Vienna Lager</option>
                                <option value="Pilsner">Pilsner</option>
                                <option value="Pale Ale">Pale Ale</option>
                                <option value="IPA">IPA</option>
                                <option value="Stout">Stout</option>
                                <option value="Imperial Stout">Imperial Stout</option>
                                <option value="Wheat Beer">Wheat Beer</option>
                            </select>
                            <select class="filter-select" id="filterPrice">
                                <option value="">💰 Todos los precios</option>
                                <option value="0-50">$0 - $50</option>
                                <option value="50-80">$50 - $80</option>
                                <option value="80-120">$80 - $120</option>
                                <option value="120+">$120+</option>
                            </select>
                            <select class="filter-select" id="filterRating">
                                <option value="">⭐ Todas las calificaciones</option>
                                <option value="4.5+">4.5+ estrellas</option>
                                <option value="4.0+">4.0+ estrellas</option>
                                <option value="3.5+">3.5+ estrellas</option>
                            </select>
                            <select class="filter-select" id="filterCategory">
                                <option value="">🏷️ Todas las categorías</option>
                                <option value="featured">⭐ Destacadas</option>
                                <option value="premium">💎 Premium ($100+)</option>
                                <option value="artesanal">🍺 Artesanales</option>
                                <option value="comercial">🏭 Comerciales</option>
                                <option value="grupo-modelo">🍻 Grupo Modelo</option>
                                <option value="heineken">🍺 Heineken México</option>
                            </select>
                            <select class="filter-select" id="sortBy">
                                <option value="default">Ordenar por...</option>
                                <option value="price-asc">💰 Precio: Menor a Mayor</option>
                                <option value="price-desc">💰 Precio: Mayor a Menor</option>
                                <option value="rating-desc">⭐ Mejor Calificación</option>
                                <option value="name-asc">🔤 Nombre: A-Z</option>
                                <option value="name-desc">🔤 Nombre: Z-A</option>
                            </select>
                            <button class="filter-btn" id="clearFilters">
                                <i class="fas fa-times"></i> Limpiar Filtros
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="results-info" id="resultsInfo" style="display: none;">
                    <div class="results-content">
                        <i class="fas fa-check-circle"></i>
                        <span><strong id="resultsCount">0</strong> productos encontrados</span>
                    </div>
                    <div class="view-toggle">
                        <span class="view-mode-label" id="viewModeLabel">Vista en cuadrícula</span>
                        <button class="view-toggle-btn" id="toggleView" aria-label="Cambiar vista">
                            <i class="fas fa-th"></i>
                        </button>
                    </div>
                </div>
                
                <div class="beer-grid" id="beerGrid">
                    <!-- Las cervezas se generarán dinámicamente con JavaScript -->
                </div>
            </div>
        </section>

        <!-- Vista del Carrito -->
        <section id="cartView" class="view">
            <div class="cart-content">
                <div class="catalog-header">
                    <button type="button" class="back-btn" id="backToDashboardFromCart">
                        <i class="fas fa-arrow-left"></i> Volver
                    </button>
                    <h1 class="catalog-title">Mi Carrito</h1>
                </div>
                
                <div id="cartItems"></div>
                
                <div id="cartSummarySection" style="display: none;">
                    <div class="cart-summary">
                        <!-- Opciones de Entrega -->
                        <div class="delivery-options-section">
                            <h4><i class="fas fa-truck" style="color: #667eea;"></i> Método de Entrega</h4>
                            <div class="delivery-options">
                                <label class="delivery-option">
                                    <input type="radio" name="deliveryMethod" value="pickup" id="pickupOption" checked>
                                    <div class="delivery-option-content">
                                        <div class="delivery-option-icon">
                                            <i class="fas fa-store"></i>
                                        </div>
                                        <div class="delivery-option-info">
                                            <strong>Recoger en Tienda</strong>
                                            <p>Gratis - Listo en 30 minutos</p>
                                        </div>
                                    </div>
                                </label>
                                
                                <label class="delivery-option">
                                    <input type="radio" name="deliveryMethod" value="delivery" id="deliveryOption">
                                    <div class="delivery-option-content">
                                        <div class="delivery-option-icon">
                                            <i class="fas fa-truck"></i>
                                        </div>
                                        <div class="delivery-option-info">
                                            <strong>Entrega a Domicilio</strong>
                                            <p>Desde $50.00 - 30-60 min</p>
                                        </div>
                                    </div>
                                </label>
                            </div>
                        </div>

                        <!-- Selección de Tienda (solo para pickup) -->
                        <div class="pickup-stores-section" id="pickupStoresSection" style="display: block;">
                            <h4><i class="fas fa-map-marker-alt" style="color: #667eea;"></i> Selecciona una Tienda</h4>
                            <div id="storesList" class="stores-list">
                                <div class="loading-stores">
                                    <i class="fas fa-spinner fa-spin"></i>
                                    <span>Cargando tiendas disponibles...</span>
                                </div>
                            </div>
                        </div>

                        <!-- Formulario de Dirección de Entrega -->
                        <div class="delivery-address-section" id="deliveryAddressSection" style="display: none;">
                            <h4><i class="fas fa-map-marker-alt" style="color: #667eea;"></i> Dirección de Entrega</h4>
                            
                            <!-- Selector de direcciones guardadas -->
                            <div class="saved-addresses" id="savedAddressesSelector">
                                <label class="form-label">Usar dirección guardada:</label>
                                <select id="savedAddressSelect" class="form-input">
                                    <option value="">Nueva dirección...</option>
                                </select>
                            </div>

                            <!-- Búsqueda con Google Maps -->
                            <div class="map-search-container">
                                <div class="form-group">
                                    <label class="form-label">
                                        <i class="fas fa-search"></i> Buscar dirección en el mapa
                                    </label>
                                    <div class="address-search-wrapper">
                                        <input type="text" id="addressSearch" class="form-input address-search-input" placeholder="Busca tu dirección, colonia o punto de referencia..." autocomplete="off">
                                        <button type="button" class="map-current-location-btn" id="useCurrentLocation" title="Usar mi ubicación actual">
                                            <i class="fas fa-crosshairs"></i>
                                        </button>
                                    </div>
                                </div>
                                
                                <!-- Contenedor del mapa -->
                                <div class="map-container">
                                    <div id="deliveryMap" class="delivery-map"></div>
                                    <div class="map-instructions">
                                        <i class="fas fa-info-circle"></i>
                                        <span>Busca tu dirección o arrastra el marcador en el mapa</span>
                                    </div>
                                </div>
                            </div>

                            <div class="address-form" id="addressForm">
                                <div class="form-group">
                                    <label class="form-label">Calle y Número</label>
                                    <input type="text" id="deliveryStreet" class="form-input" placeholder="Av. Principal #123" required>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label class="form-label">Colonia</label>
                                        <input type="text" id="deliveryColony" class="form-input" placeholder="Centro" required>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Código Postal</label>
                                        <input type="text" id="deliveryPostalCode" class="form-input" placeholder="01000" required maxlength="5">
                                    </div>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label class="form-label">Ciudad</label>
                                        <input type="text" id="deliveryCity" class="form-input" placeholder="Ciudad de México" required>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Estado</label>
                                        <input type="text" id="deliveryState" class="form-input" placeholder="CDMX" required>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label class="form-label">Referencias</label>
                                    <textarea id="deliveryReferences" class="form-input" rows="2" placeholder="Casa blanca con portón negro, entre calles..."></textarea>
                                </div>

                                <div class="form-group">
                                    <label class="form-label">Teléfono de Contacto</label>
                                    <input type="tel" id="deliveryPhone" class="form-input" placeholder="+52 555 123 4567" required>
                                </div>

                                <div class="form-group">
                                    <label class="checkbox-label">
                                        <input type="checkbox" id="saveAddress">
                                        <span>Guardar esta dirección para futuros pedidos</span>
                                    </label>
                                </div>
                            </div>

                            <!-- Información de zona de entrega -->
                            <div class="delivery-zone-info" id="deliveryZoneInfo" style="display: none;">
                                <div class="zone-alert">
                                    <i class="fas fa-info-circle"></i>
                                    <div>
                                        <strong>Zona de entrega: <span id="zoneName"></span></strong>
                                        <p id="zoneMessage"></p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Descuentos -->
                        <div class="discount-section">
                            <h4><i class="fas fa-star" style="color: #fdbb2d;"></i> Usar CervezaPoints</h4>
                            <p style="font-size: 14px; margin: 8px 0;">Tienes <span id="availablePoints">1,250</span> puntos disponibles</p>
                            <div class="discount-input">
                                <input type="number" id="pointsToUse" placeholder="Puntos a usar" min="0" max="1250">
                                <button class="discount-btn" id="applyPointsBtn">Aplicar</button>
                            </div>
                            <div id="pointsDiscount" style="display: none; margin-top: 10px; color: #27ae60; font-weight: 600;">
                                <i class="fas fa-check"></i> Descuento aplicado: -$<span id="discountAmount">0</span>
                            </div>
                        </div>
                        
                        <!-- Resumen de Costos -->
                        <div class="summary-row">
                            <span>Subtotal:</span>
                            <span id="subtotal">$0.00</span>
                        </div>
                        <div class="summary-row" id="discountRow" style="display: none;">
                            <span>Descuento (CervezaPoints):</span>
                            <span id="discountTotal" style="color: #27ae60;">-$0.00</span>
                        </div>
                        <div class="summary-row" id="shippingRow">
                            <span>Envío:</span>
                            <span id="shippingCost">Gratis</span>
                        </div>
                        <div class="summary-row">
                            <span>Puntos que ganarás:</span>
                            <span id="pointsToEarn" style="color: #fdbb2d; font-weight: 600;">+0 pts</span>
                        </div>
                        <div class="summary-row summary-total">
                            <span>Total:</span>
                            <span id="total">$0.00</span>
                        </div>
                        
                        <!-- Métodos de Pago -->
                        <div class="payment-methods-section">
                            <h4><i class="fas fa-credit-card" style="color: #667eea;"></i> Método de Pago</h4>
                            <div class="payment-methods-grid">
                                <!-- Tarjeta de Crédito/Débito -->
                                <label class="payment-method-card" data-method="tarjeta">
                                    <input type="radio" name="paymentMethod" value="tarjeta" id="paymentTarjeta" checked>
                                    <div class="payment-method-content">
                                        <div class="payment-method-icon">
                                            <i class="fas fa-credit-card"></i>
                                        </div>
                                        <div class="payment-method-info">
                                            <strong>Tarjeta de Crédito/Débito</strong>
                                            <p>Visa, Mastercard, Amex</p>
                                        </div>
                                        <div class="payment-method-check">
                                            <i class="fas fa-check-circle"></i>
                                        </div>
                                    </div>
                                </label>

                                <!-- Efectivo -->
                                <label class="payment-method-card" data-method="efectivo">
                                    <input type="radio" name="paymentMethod" value="efectivo" id="paymentEfectivo">
                                    <div class="payment-method-content">
                                        <div class="payment-method-icon efectivo-icon">
                                            <i class="fas fa-money-bill-wave"></i>
                                        </div>
                                        <div class="payment-method-info">
                                            <strong>Efectivo</strong>
                                            <p>Pago al recibir</p>
                                        </div>
                                        <div class="payment-method-check">
                                            <i class="fas fa-check-circle"></i>
                                        </div>
                                    </div>
                                </label>

                                <!-- Transferencia Bancaria -->
                                <label class="payment-method-card" data-method="transferencia">
                                    <input type="radio" name="paymentMethod" value="transferencia" id="paymentTransferencia">
                                    <div class="payment-method-content">
                                        <div class="payment-method-icon transferencia-icon">
                                            <i class="fas fa-university"></i>
                                        </div>
                                        <div class="payment-method-info">
                                            <strong>Transferencia Bancaria</strong>
                                            <p>BBVA, Banorte, Santander</p>
                                        </div>
                                        <div class="payment-method-check">
                                            <i class="fas fa-check-circle"></i>
                                        </div>
                                    </div>
                                </label>

                                <!-- PayPal -->
                                <label class="payment-method-card" data-method="paypal">
                                    <input type="radio" name="paymentMethod" value="paypal" id="paymentPaypal">
                                    <div class="payment-method-content">
                                        <div class="payment-method-icon paypal-icon">
                                            <i class="fab fa-paypal"></i>
                                        </div>
                                        <div class="payment-method-info">
                                            <strong>PayPal</strong>
                                            <p>Pago seguro con PayPal</p>
                                        </div>
                                        <div class="payment-method-check">
                                            <i class="fas fa-check-circle"></i>
                                        </div>
                                    </div>
                                </label>
                            </div>

                            <!-- Formulario de Tarjeta (solo se muestra si se selecciona tarjeta) -->
                            <div class="payment-form-container" id="cardPaymentForm" style="display: none;">
                                <div class="payment-form-header">
                                    <h5><i class="fas fa-lock"></i> Información de la Tarjeta</h5>
                                    <p class="payment-form-note">💳 Modo de Prueba: Usa cualquier número de tarjeta válido</p>
                                </div>
                                <div class="payment-form-body">
                                    <div class="form-group">
                                        <label class="form-label">Número de Tarjeta</label>
                                        <input type="text" id="cardNumber" class="form-input" placeholder="1234 5678 9012 3456" maxlength="19" pattern="[0-9\s]+">
                                        <small class="form-help">Ejemplo: 4111 1111 1111 1111 (Visa) o 5555 5555 5555 4444 (Mastercard)</small>
                                    </div>
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label class="form-label">Nombre en la Tarjeta</label>
                                            <input type="text" id="cardName" class="form-input" placeholder="JUAN PEREZ">
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">CVV</label>
                                            <input type="text" id="cardCvv" class="form-input" placeholder="123" maxlength="4" pattern="[0-9]+">
                                        </div>
                                    </div>
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label class="form-label">Mes</label>
                                            <select id="cardMonth" class="form-input">
                                                <option value="">MM</option>
                                                <option value="01">01</option>
                                                <option value="02">02</option>
                                                <option value="03">03</option>
                                                <option value="04">04</option>
                                                <option value="05">05</option>
                                                <option value="06">06</option>
                                                <option value="07">07</option>
                                                <option value="08">08</option>
                                                <option value="09">09</option>
                                                <option value="10">10</option>
                                                <option value="11">11</option>
                                                <option value="12">12</option>
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">Año</label>
                                            <select id="cardYear" class="form-input">
                                                <option value="">AAAA</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="payment-test-info">
                                        <i class="fas fa-info-circle"></i>
                                        <div>
                                            <strong>Tarjetas de Prueba:</strong>
                                            <ul>
                                                <li><strong>Visa:</strong> 4111 1111 1111 1111</li>
                                                <li><strong>Mastercard:</strong> 5555 5555 5555 4444</li>
                                                <li><strong>Amex:</strong> 3782 822463 10005</li>
                                                <li>Cualquier CVV de 3-4 dígitos</li>
                                                <li>Fecha futura (cualquier mes/año)</li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Información de Transferencia (solo se muestra si se selecciona transferencia) -->
                            <div class="payment-info-container" id="transferPaymentInfo" style="display: none;">
                                <div class="payment-info-card">
                                    <h5><i class="fas fa-university"></i> Datos para Transferencia</h5>
                                    <div class="transfer-details">
                                        <div class="transfer-item">
                                            <span class="transfer-label">Banco:</span>
                                            <span class="transfer-value">BBVA Bancomer</span>
                                        </div>
                                        <div class="transfer-item">
                                            <span class="transfer-label">CLABE:</span>
                                            <span class="transfer-value">012 180 001234567890 1</span>
                                            <button class="copy-btn" onclick="copyToClipboard('012 180 001234567890 1')">
                                                <i class="fas fa-copy"></i>
                                            </button>
                                        </div>
                                        <div class="transfer-item">
                                            <span class="transfer-label">Cuenta:</span>
                                            <span class="transfer-value">0123456789</span>
                                            <button class="copy-btn" onclick="copyToClipboard('0123456789')">
                                                <i class="fas fa-copy"></i>
                                            </button>
                                        </div>
                                        <div class="transfer-item">
                                            <span class="transfer-label">Beneficiario:</span>
                                            <span class="transfer-value">Cerveza Premium S.A. de C.V.</span>
                                        </div>
                                    </div>
                                    <p class="transfer-note">
                                        <i class="fas fa-info-circle"></i>
                                        Envía el comprobante de transferencia a <strong>pagos&#64;cervezapremium.com</strong> o por WhatsApp al <strong>+52 55 1234 5678</strong>
                                    </p>
                                </div>
                            </div>

                            <!-- Información de PayPal (solo se muestra si se selecciona PayPal) -->
                            <div class="payment-info-container" id="paypalPaymentInfo" style="display: none;">
                                <div class="payment-info-card paypal-card">
                                    <h5><i class="fab fa-paypal"></i> Pago con PayPal</h5>
                                    <div class="paypal-info">
                                        <div class="paypal-description">
                                            <p>Serás redirigido a PayPal para completar tu pago de forma segura.</p>
                                        </div>
                                        <div class="paypal-features">
                                            <div class="paypal-feature">
                                                <i class="fas fa-shield-alt"></i>
                                                <span>Pago 100% seguro</span>
                                            </div>
                                            <div class="paypal-feature">
                                                <i class="fas fa-lock"></i>
                                                <span>Datos protegidos</span>
                                            </div>
                                            <div class="paypal-feature">
                                                <i class="fas fa-bolt"></i>
                                                <span>Pago rápido</span>
                                            </div>
                                        </div>
                                        <div class="paypal-test-info">
                                            <i class="fas fa-info-circle"></i>
                                            <div>
                                                <strong>Modo de Prueba:</strong>
                                                <p>En el entorno de prueba, puedes usar cualquier cuenta de PayPal o las credenciales de prueba:</p>
                                                <ul>
                                                    <li><strong>Email de prueba:</strong> buyer&#64;paypalsandbox.com</li>
                                                    <li><strong>Contraseña:</strong> Cualquier contraseña válida</li>
                                                    <li>O simplemente simula el proceso de pago</li>
                                                </ul>
                                            </div>
                                        </div>
                                        <div class="paypal-button-preview">
                                            <button class="paypal-button" id="paypalContinueBtn" type="button">
                                                <i class="fab fa-paypal"></i>
                                                <span>Continuar con PayPal</span>
                                            </button>
                                            <p class="paypal-note">Haz clic en el botón de arriba o en "Proceder al Pago" para continuar</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <button class="checkout-btn" id="checkoutBtn">
                            <i class="fas fa-credit-card"></i> Proceder al Pago
                        </button>
                    </div>
                </div>
                
                <div class="empty-cart" id="emptyCart">
                    <i class="fas fa-shopping-cart"></i>
                    <h3>Tu carrito está vacío</h3>
                    <p>Agrega algunas cervezas para comenzar</p>
                    <button class="login-button" id="continueShopping" style="max-width: 300px; margin: 0 auto;">
                        <i class="fas fa-beer"></i> Continuar Comprando
                    </button>
                </div>
            </div>
        </section>

        <!-- Vista del Perfil -->
        <section id="profileView" class="view">
            <div class="profile-content">
                <div class="catalog-header">
                    <button type="button" class="back-btn" id="backToDashboardFromProfile">
                        <i class="fas fa-arrow-left"></i> Volver
                    </button>
                    <h1 class="catalog-title">
                        <i class="fas fa-user-circle"></i> Mi Perfil
                    </h1>
                </div>
                
                <!-- Tarjeta de información del usuario -->
                <div class="profile-header-card">
                    <div class="profile-avatar-section">
                        <div class="profile-avatar-large" id="profileAvatar">
                            <span id="avatarInitials">
                              {{currentUser?.nombre_completo ? (currentUser!.nombre_completo.split(' ')[0].charAt(0) + ((currentUser!.nombre_completo.split(' ')[1] || '').charAt(0) || '')) : 'U'}}
                            </span>
                            <div class="avatar-overlay">
                                <label for="avatarUpload" class="avatar-upload-btn" title="Cambiar foto">
                                    <i class="fas fa-camera"></i>
                                </label>
                                <input type="file" id="avatarUpload" accept="image/*" style="display: none;">
                            </div>
                        </div>
                        <div class="profile-info-header">
                            <h2 id="profileDisplayName">{{currentUser?.nombre_completo || 'Usuario'}}</h2>
                            <p id="profileDisplayEmail">{{currentUser?.email || 'usuario@ejemplo.com'}}</p>
                            <div class="profile-badge">
                                <i class="fas fa-star"></i>
                                <span id="profilePoints">{{currentUser?.puntos_acumulados || 0}} puntos</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Estadísticas rápidas -->
                    <div class="profile-stats">
                        <div class="stat-item">
                            <div class="stat-icon" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                                <i class="fas fa-shopping-bag"></i>
                            </div>
                            <div class="stat-info">
                                <div class="stat-value" id="totalOrders">0</div>
                                <div class="stat-label">Pedidos</div>
                            </div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-icon" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                                <i class="fas fa-heart"></i>
                            </div>
                            <div class="stat-info">
                                <div class="stat-value" id="totalFavorites">0</div>
                                <div class="stat-label">Favoritos</div>
                            </div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-icon" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                                <i class="fas fa-calendar-alt"></i>
                            </div>
                            <div class="stat-info">
                                <div class="stat-value" id="memberSince">2024</div>
                                <div class="stat-label">Miembro desde</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tabs de navegación del perfil -->
                <div class="profile-tabs">
                    <button class="profile-tab active" data-tab="personal">
                        <i class="fas fa-user"></i> Información Personal
                    </button>
                    <button class="profile-tab" data-tab="security">
                        <i class="fas fa-lock"></i> Seguridad
                    </button>
                    <button class="profile-tab" data-tab="preferences">
                        <i class="fas fa-cog"></i> Preferencias
                    </button>
                </div>

                <!-- Contenido de las tabs -->
                <div class="profile-tab-content">
                    <!-- Tab: Información Personal -->
                    <div class="tab-pane active" id="personalTab">
                        <form class="profile-form" id="profileForm">
                            <div class="form-section-title">
                                <i class="fas fa-id-card"></i> Datos Personales
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label" for="profileName">
                                        <i class="fas fa-user"></i> Nombre Completo
                                    </label>
                                    <input 
                                        type="text" 
                                        id="profileName" 
                                        name="name" 
                                        class="form-input" 
                                        placeholder="Tu nombre completo"
                                        [value]="currentUser?.nombre_completo || ''"
                                    />
                                </div>

                                <div class="form-group">
                                    <label class="form-label" for="profileEmail">
                                        <i class="fas fa-envelope"></i> Correo Electrónico
                                    </label>
                                    <input 
                                        type="email" 
                                        id="profileEmail" 
                                        name="email" 
                                        class="form-input"
                                        placeholder="tu@email.com"
                                        [value]="currentUser?.email || ''"
                                        disabled
                                    />
                                    <small class="form-help">El correo no se puede modificar</small>
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label" for="profilePhone">
                                        <i class="fas fa-phone"></i> Teléfono
                                    </label>
                                    <input 
                                        type="tel" 
                                        id="profilePhone" 
                                        name="phone" 
                                        class="form-input"
                                        placeholder="+52 123 456 7890"
                                        [value]="currentUser?.telefono || ''"
                                    />
                                </div>

                                <div class="form-group">
                                    <label class="form-label" for="profileBirthDate">
                                        <i class="fas fa-birthday-cake"></i> Fecha de Nacimiento
                                    </label>
                                    <input 
                                        type="date" 
                                        id="profileBirthDate" 
                                        name="birthDate" 
                                        class="form-input"
                                        [value]="(currentUser?.fecha_nacimiento || '').substring(0, 10)"
                                    />
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="form-label" for="profileAddress">
                                    <i class="fas fa-map-marker-alt"></i> Dirección
                                </label>
                                <textarea 
                                    id="profileAddress" 
                                    name="address" 
                                    class="form-input"
                                    placeholder="Calle, número, colonia, ciudad, estado, código postal"
                                    rows="3"
                                >{{currentUser?.direccion || ''}}</textarea>
                            </div>

                            <div class="form-actions">
                                <button type="submit" class="btn-save-profile">
                                    <i class="fas fa-save"></i> Guardar Cambios
                                </button>
                                <button type="button" class="btn-cancel-profile" onclick="document.getElementById('profileForm').reset()">
                                    <i class="fas fa-times"></i> Cancelar
                                </button>
                            </div>
                        </form>
                    </div>

                    <!-- Tab: Seguridad -->
                    <div class="tab-pane" id="securityTab">
                        <div class="form-section-title">
                            <i class="fas fa-shield-alt"></i> Seguridad de la Cuenta
                        </div>
                        
                        <form class="profile-form" id="changePasswordForm">
                            <div class="security-section">
                                <h3 class="section-subtitle">
                                    <i class="fas fa-key"></i> Cambiar Contraseña
                                </h3>
                                
                                <div class="form-group">
                                    <label class="form-label" for="currentPassword">
                                        <i class="fas fa-lock"></i> Contraseña Actual
                                    </label>
                                    <div class="password-input-wrapper">
                                        <input 
                                            type="password" 
                                            id="currentPassword" 
                                            name="currentPassword" 
                                            class="form-input"
                                            placeholder="Ingresa tu contraseña actual"
                                        />
                                        <button type="button" class="password-toggle-btn" onclick="togglePassword('currentPassword')">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label class="form-label" for="newPassword">
                                        <i class="fas fa-lock"></i> Nueva Contraseña
                                    </label>
                                    <div class="password-input-wrapper">
                                        <input 
                                            type="password" 
                                            id="newPassword" 
                                            name="newPassword" 
                                            class="form-input"
                                            placeholder="Mínimo 8 caracteres"
                                        />
                                        <button type="button" class="password-toggle-btn" onclick="togglePassword('newPassword')">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                    </div>
                                    <div class="password-strength" id="newPasswordStrength"></div>
                                </div>

                                <div class="form-group">
                                    <label class="form-label" for="confirmPassword">
                                        <i class="fas fa-lock"></i> Confirmar Nueva Contraseña
                                    </label>
                                    <div class="password-input-wrapper">
                                        <input 
                                            type="password" 
                                            id="confirmPassword" 
                                            name="confirmPassword" 
                                            class="form-input"
                                            placeholder="Confirma tu nueva contraseña"
                                        />
                                        <button type="button" class="password-toggle-btn" onclick="togglePassword('confirmPassword')">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                    </div>
                                </div>

                                <div class="form-actions">
                                    <button type="submit" class="btn-save-profile">
                                        <i class="fas fa-key"></i> Cambiar Contraseña
                                    </button>
                                </div>
                            </div>
                        </form>
                    </div>

                    <!-- Tab: Preferencias -->
                    <div class="tab-pane" id="preferencesTab">
                        <div class="form-section-title">
                            <i class="fas fa-sliders-h"></i> Preferencias y Configuración
                        </div>
                        
                        <div class="preferences-section">
                            <div class="preference-item">
                                <div class="preference-info">
                                    <h4>
                                        <i class="fas fa-bell"></i> Notificaciones por Email
                                    </h4>
                                    <p>Recibe notificaciones sobre tus pedidos y promociones</p>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="emailNotifications" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>

                            <div class="preference-item">
                                <div class="preference-info">
                                    <h4>
                                        <i class="fas fa-gift"></i> Notificaciones de Promociones
                                    </h4>
                                    <p>Recibe ofertas especiales y descuentos exclusivos</p>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="promoNotifications" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>

                            <div class="preference-item">
                                <div class="preference-info">
                                    <h4>
                                        <i class="fas fa-shopping-cart"></i> Notificaciones de Pedidos
                                    </h4>
                                    <p>Actualizaciones sobre el estado de tus pedidos</p>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="orderNotifications" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>

                            <div class="preference-item">
                                <div class="preference-info">
                                    <h4>
                                        <i class="fas fa-moon"></i> Modo Oscuro
                                    </h4>
                                    <p>Activa el tema oscuro para una mejor experiencia</p>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="darkMode">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>

                        <div class="form-actions">
                            <button type="button" class="btn-save-profile" onclick="savePreferences()">
                                <i class="fas fa-save"></i> Guardar Preferencias
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Vista de Pedidos -->
        <section id="ordersView" class="view">
            <div class="orders-content">
                <div class="catalog-header">
                    <button type="button" class="back-btn" id="backToDashboardFromOrders">
                        <i class="fas fa-arrow-left"></i> Volver
                    </button>
                    <h1 class="catalog-title">Mis Pedidos</h1>
                </div>
                
                <div class="orders-list">
                    <!-- Los pedidos se generarán dinámicamente con JavaScript -->
          </div>
        </div>
      </section>

      <!-- Vista de Favoritos -->
      <section id="favoritesView" class="view">
        <div class="profile-content">
          <div class="catalog-header">
            <button type="button" class="back-btn" id="backToDashboardFromFavorites">
              <i class="fas fa-arrow-left"></i> Volver
            </button>
            <h1 class="catalog-title"><i class="fas fa-heart"></i> Mis Favoritos</h1>
          </div>
          <div class="favorites-grid">
            <!-- Los favoritos se generarán dinámicamente -->
          </div>
        </div>
      </section>

      <!-- Vista de Direcciones -->
      <section id="addressesView" class="view">
        <div class="profile-content">
          <div class="catalog-header">
            <button type="button" class="back-btn" id="backToDashboardFromAddresses">
              <i class="fas fa-arrow-left"></i> Volver
            </button>
            <h1 class="catalog-title"><i class="fas fa-map-marker-alt"></i> Mis Direcciones</h1>
          </div>
          
          <div class="addresses-header">
            <p class="addresses-subtitle">Administra tus direcciones de envío para hacer tus pedidos más rápido</p>
          <button class="add-address-btn" id="addAddressBtn">
            <i class="fas fa-plus"></i> Agregar Nueva Dirección
          </button>
          </div>
          
          <div class="addresses-list">
            <!-- Las direcciones se generarán dinámicamente -->
          </div>
        </div>
        
        <!-- Modal para agregar/editar dirección -->
        <div id="addressModal" class="modal" style="display: none;">
          <div class="modal-content address-modal">
            <div class="modal-header">
              <h2 id="addressModalTitle">
                <i class="fas fa-map-marker-alt"></i> Agregar Nueva Dirección
              </h2>
              <button class="modal-close" id="closeAddressModal">
                <i class="fas fa-times"></i>
              </button>
            </div>
            <form id="addressForm" class="address-form">
              <div class="form-group">
                <label class="form-label" for="addressLabel">
                  <i class="fas fa-tag"></i> Etiqueta
                </label>
                <select id="addressLabel" class="form-input" required>
                  <option value="">Selecciona una etiqueta</option>
                  <option value="Casa">Casa</option>
                  <option value="Oficina">Oficina</option>
                  <option value="Otro">Otro</option>
                </select>
                <input type="text" id="addressLabelCustom" class="form-input" placeholder="Escribe tu etiqueta personalizada" style="display: none; margin-top: 10px;">
              </div>
              
              <div class="form-group">
                <label class="form-label" for="addressStreet">
                  <i class="fas fa-road"></i> Calle y Número *
                </label>
                <input type="text" id="addressStreet" class="form-input" placeholder="Ej: Av. Revolución 1234" required>
              </div>
              
              <div class="form-row">
                <div class="form-group">
                  <label class="form-label" for="addressCity">
                    <i class="fas fa-city"></i> Ciudad *
                  </label>
                  <input type="text" id="addressCity" class="form-input" placeholder="Ciudad" required>
                </div>
                
                <div class="form-group">
                  <label class="form-label" for="addressState">
                    <i class="fas fa-map"></i> Estado *
                  </label>
                  <input type="text" id="addressState" class="form-input" placeholder="Estado" required>
                </div>
              </div>
              
              <div class="form-row">
                <div class="form-group">
                  <label class="form-label" for="addressZipCode">
                    <i class="fas fa-mail-bulk"></i> Código Postal *
                  </label>
                  <input type="text" id="addressZipCode" class="form-input" placeholder="CP: 01000" pattern="[0-9]{5}" maxlength="5" required>
                </div>
                
                <div class="form-group">
                  <label class="form-label" for="addressPhone">
                    <i class="fas fa-phone"></i> Teléfono (Opcional)
                  </label>
                  <input type="tel" id="addressPhone" class="form-input" placeholder="55 1234 5678" pattern="[0-9\s]{10,15}">
                </div>
              </div>
              
              <div class="form-group">
                <label class="form-label" for="addressReference">
                  <i class="fas fa-info-circle"></i> Referencias (Opcional)
                </label>
                <textarea id="addressReference" class="form-input" rows="3" placeholder="Ej: Entre calles X y Y, edificio azul, piso 3"></textarea>
              </div>
              
              <div class="form-group checkbox-group">
                <label class="checkbox-label">
                  <input type="checkbox" id="addressDefault">
                  <span>Establecer como dirección predeterminada</span>
                </label>
              </div>
              
              <div class="form-actions">
                <button type="submit" class="btn-primary">
                  <i class="fas fa-save"></i> Guardar Dirección
                </button>
                <button type="button" class="btn-secondary" id="cancelAddressForm">
                  <i class="fas fa-times"></i> Cancelar
                </button>
              </div>
            </form>
          </div>
        </div>
      </section>

      <!-- Vista de Notificaciones -->
      <section id="notificationsView" class="view">
        <div class="notifications-content">
          <div class="catalog-header">
            <button type="button" class="back-btn" id="backToDashboardFromNotifications">
              <i class="fas fa-arrow-left"></i> Volver
            </button>
            <h1 class="catalog-title">
              <i class="fas fa-bell"></i> Notificaciones
              <span class="notifications-count-badge" id="notificationsTotalCount">0</span>
            </h1>
          </div>
          
          <!-- Barra de acciones y filtros -->
          <div class="notifications-toolbar">
            <div class="notifications-filters">
              <button class="filter-btn active" data-filter="all" id="filterAll">
                <i class="fas fa-list"></i> Todas
              </button>
              <button class="filter-btn" data-filter="unread" id="filterUnread">
                <i class="fas fa-circle"></i> No leídas
                <span class="filter-badge" id="unreadCountBadge">0</span>
              </button>
              <button class="filter-btn" data-filter="read" id="filterRead">
                <i class="fas fa-check-double"></i> Leídas
              </button>
            </div>
            
            <div class="notifications-actions">
              <button class="action-btn" id="markAllReadBtn" title="Marcar todas como leídas">
                <i class="fas fa-check-double"></i> Marcar todas como leídas
              </button>
              <button class="action-btn danger" id="deleteAllReadBtn" title="Eliminar todas las leídas">
                <i class="fas fa-trash"></i> Eliminar leídas
              </button>
            </div>
          </div>
          
          <!-- Estadísticas rápidas -->
          <div class="notifications-stats">
            <div class="stat-card">
              <div class="stat-icon unread">
                <i class="fas fa-circle"></i>
              </div>
              <div class="stat-info">
                <div class="stat-value" id="statsUnread">0</div>
                <div class="stat-label">No leídas</div>
              </div>
            </div>
            <div class="stat-card">
              <div class="stat-icon read">
                <i class="fas fa-check-double"></i>
              </div>
              <div class="stat-info">
                <div class="stat-value" id="statsRead">0</div>
                <div class="stat-label">Leídas</div>
              </div>
            </div>
            <div class="stat-card">
              <div class="stat-icon total">
                <i class="fas fa-bell"></i>
              </div>
              <div class="stat-info">
                <div class="stat-value" id="statsTotal">0</div>
                <div class="stat-label">Total</div>
              </div>
            </div>
          </div>
          
          <!-- Lista de notificaciones -->
          <div class="notifications-list" id="notificationsListContainer">
            <!-- Las notificaciones se generarán dinámicamente -->
          </div>
          
          <!-- Estado vacío -->
          <div class="notifications-empty" id="notificationsEmpty" style="display: none;">
            <div class="empty-icon">
              <i class="fas fa-bell-slash"></i>
            </div>
            <h3>No hay notificaciones</h3>
            <p>Te avisaremos cuando haya novedades sobre tus pedidos y promociones</p>
          </div>
        </div>
      </section>

      <!-- Vista de Configuración -->
      <section id="settingsView" class="view">
        <div class="profile-content">
          <div class="catalog-header">
            <button type="button" class="back-btn" id="backToDashboardFromSettings">
              <i class="fas fa-arrow-left"></i> Volver
            </button>
            <h1 class="catalog-title"><i class="fas fa-sliders-h"></i> Configuración</h1>
          </div>
          <div class="settings-sections">
            <div class="settings-section">
              <h3><i class="fas fa-bell"></i> Notificaciones</h3>
              <div class="setting-item">
                <label>
                  <input type="checkbox" id="emailNotifications" checked>
                  <span>Recibir notificaciones por email</span>
                </label>
              </div>
              <div class="setting-item">
                <label>
                  <input type="checkbox" id="promotionNotifications" checked>
                  <span>Recibir ofertas y promociones</span>
                </label>
              </div>
              <div class="setting-item">
                <label>
                  <input type="checkbox" id="orderNotifications" checked>
                  <span>Notificaciones de pedidos</span>
                </label>
              </div>
            </div>
            <div class="settings-section">
              <h3><i class="fas fa-shield-alt"></i> Privacidad</h3>
              <div class="setting-item">
                <label>
                  <input type="checkbox" id="publicProfile">
                  <span>Perfil público</span>
                </label>
              </div>
              <div class="setting-item">
                <label>
                  <input type="checkbox" id="shareData">
                  <span>Compartir datos para mejores recomendaciones</span>
                </label>
              </div>
            </div>
            <div class="settings-section">
              <h3><i class="fas fa-palette"></i> Apariencia</h3>
              <div class="setting-item">
                <label>
                  <span>Tema</span>
                  <select id="themeSelector" class="theme-select">
                    <option value="dark">Oscuro</option>
                    <option value="light">Claro</option>
                    <option value="auto">Automático</option>
                  </select>
                </label>
              </div>
            </div>
            <button class="save-settings-btn" id="saveSettingsBtn">
              <i class="fas fa-save"></i> Guardar Cambios
            </button>
          </div>
        </div>
      </section>

      <!-- Vista de Recomendaciones -->
      <section id="recommendationsView" class="view">
        <div class="profile-content">
          <div class="catalog-header">
            <button type="button" class="back-btn" id="backToDashboardFromRecommendations">
              <i class="fas fa-arrow-left"></i> Volver
            </button>
            <h1 class="catalog-title"><i class="fas fa-magic"></i> Recomendaciones</h1>
          </div>
          <div class="recommendations-grid">
            <!-- Las recomendaciones se generarán dinámicamente -->
          </div>
        </div>
      </section>
    </main>

    <!-- Popup de mensajes -->
    <div class="message-popup info" id="messagePopup">
      <div class="message-content">
        <div class="message-icon">
          <i class="fas fa-info-circle"></i>
        </div>
        <div class="message-text" id="messageText">Mensaje de ejemplo</div>
        <button class="message-close" id="closeMessage">
          <i class="fas fa-times"></i>
        </button>
    </div>
  </div>

  <script>
        // Data de cervezas mexicanas reales
        let beers = [];

        // Función para cargar cervezas mexicanas desde la API
        async function loadMexicanBeers() {
            try {
                const response = await fetch('http://localhost:4000/api/cervezas-mexicanas');
                const mexicanBeers = await response.json();
                
                // Convertir formato de API a formato del frontend
                beers = mexicanBeers.map(beer => ({
                    id: beer.id,
                    name: beer.nombre,
                    style: beer.estilo,
                    price: beer.precio,
                    rating: beer.calificacion_promedio,
                    image: beer.imagen_url,
                    description: beer.descripcion,
                    abv: beer.abv,
                    ibu: beer.ibu,
                    featured: beer.precio > 80 || beer.calificacion_promedio > 4.5,
                    pais: beer.pais,
                    cerveceria: beer.cerveceria,
                    stock: beer.stock_disponible
                }));
                
                // Renderizar cervezas después de cargar
                renderBeers();
            } catch (error) {
                console.error('Error cargando cervezas mexicanas:', error);
                // Fallback a datos estáticos si la API falla
                loadMexicanBeersStatic();
            }
        }

        // Función de respaldo con datos estáticos
        function loadMexicanBeersStatic() {
            // Datos de cervezas mexicanas reales
            beers = [
                {
                    id: 1,
                    name: "Corona Extra",
                    style: "Lager",
                    price: 45.99,
                    rating: 4.2,
                    image: "https://images.unsplash.com/photo-1608270586620-248524c67de9?w=400",
                    description: "La cerveza mexicana más famosa del mundo, ligera y refrescante",
                    abv: "4.5%",
                    ibu: "18",
                    featured: false,
                    pais: "México",
                    cerveceria: "Grupo Modelo",
                    stock: 100
                },
                {
                    id: 2,
                    name: "Dos Equis XX Lager",
                    style: "Lager",
                    price: 52.99,
                    rating: 4.3,
                    image: "https://images.unsplash.com/photo-1600788907416-456578634209?w=400",
                    description: "Cerveza lager mexicana con sabor suave y refrescante",
                    abv: "4.2%",
                    ibu: "15",
                    featured: false,
                    pais: "México",
                    cerveceria: "Grupo Modelo",
                    stock: 85
                },
                {
                    id: 3,
                    name: "Tecate Original",
                    style: "Lager",
                    price: 38.99,
                    rating: 4.0,
                    image: "https://images.unsplash.com/photo-1608270586620-248524c67de9?w=400",
                    description: "Cerveza lager tradicional mexicana, perfecta para cualquier ocasión",
                    abv: "4.0%",
                    ibu: "12",
                    featured: false,
                    pais: "México",
                    cerveceria: "Heineken México",
                    stock: 120
                },
                {
                    id: 4,
                    name: "Negra Modelo",
                    style: "Vienna Lager",
                    price: 58.99,
                    rating: 4.5,
                    image: "https://images.unsplash.com/photo-1608270586620-248524c67de9?w=400",
                    description: "Cerveza oscura mexicana con maltas tostadas y sabor robusto",
                    abv: "5.4%",
                    ibu: "25",
                    featured: true,
                    pais: "México",
                    cerveceria: "Grupo Modelo",
                    stock: 75
                },
                {
                    id: 5,
                    name: "Bohemia Clara",
                    style: "Pilsner",
                    price: 65.99,
                    rating: 4.6,
                    image: "https://images.unsplash.com/photo-1600788907416-456578634209?w=400",
                    description: "Pilsner mexicana premium con lúpulos nobles y sabor limpio",
                    abv: "4.7%",
                    ibu: "22",
                    featured: true,
                    pais: "México",
                    cerveceria: "Grupo Modelo",
                    stock: 60
                },
                {
                    id: 6,
                    name: "Indio",
                    style: "Lager",
                    price: 48.99,
                    rating: 4.1,
                    image: "https://images.unsplash.com/photo-1608270586620-248524c67de9?w=400",
                    description: "Cerveza lager mexicana con carácter único y sabor distintivo",
                    abv: "4.3%",
                    ibu: "16",
                    featured: false,
                    pais: "México",
                    cerveceria: "Grupo Modelo",
                    stock: 90
                },
                {
                    id: 7,
                    name: "Sol",
                    style: "Lager",
                    price: 42.99,
                    rating: 4.0,
                    image: "https://images.unsplash.com/photo-1600788907416-456578634209?w=400",
                    description: "Cerveza lager mexicana clara y refrescante, perfecta para el clima tropical",
                    abv: "4.1%",
                    ibu: "14",
                    featured: false,
                    pais: "México",
                    cerveceria: "Heineken México",
                    stock: 110
                },
                {
                    id: 8,
                    name: "Pacifico Clara",
                    style: "Lager",
                    price: 49.99,
                    rating: 4.2,
                    image: "https://images.unsplash.com/photo-1608270586620-248524c67de9?w=400",
                    description: "Cerveza lager mexicana del Pacífico, ligera y perfecta para mariscos",
                    abv: "4.4%",
                    ibu: "17",
                    featured: false,
                    pais: "México",
                    cerveceria: "Grupo Modelo",
                    stock: 80
                },
                {
                    id: 9,
                    name: "Victoria",
                    style: "Lager",
                    price: 55.99,
                    rating: 4.4,
                    image: "https://images.unsplash.com/photo-1600788907416-456578634209?w=400",
                    description: "Cerveza lager mexicana tradicional con más de 100 años de historia",
                    abv: "4.6%",
                    ibu: "20",
                    featured: true,
                    pais: "México",
                    cerveceria: "Grupo Modelo",
                    stock: 70
                },
                {
                    id: 10,
                    name: "Estrella Jalisco",
                    style: "Lager",
                    price: 68.99,
                    rating: 4.7,
                    image: "https://images.unsplash.com/photo-1608270586620-248524c67de9?w=400",
                    description: "Cerveza lager artesanal mexicana con ingredientes locales",
                    abv: "5.2%",
                    ibu: "24",
                    featured: true,
                    pais: "México",
                    cerveceria: "Cervecería Artesanal",
                    stock: 45
                },
                {
                    id: 11,
                    name: "Cerveza Minerva",
                    style: "Pale Ale",
                    price: 75.99,
                    rating: 4.8,
                    image: "https://images.unsplash.com/photo-1535958636474-b021ee887b13?w=400",
                    description: "Cerveza artesanal mexicana con lúpulos americanos y sabor cítrico",
                    abv: "5.8%",
                    ibu: "45",
                    featured: true,
                    pais: "México",
                    cerveceria: "Cervecería Minerva",
                    stock: 35
                },
                {
                    id: 12,
                    name: "Cerveza Cucapá",
                    style: "IPA",
                    price: 82.99,
                    rating: 4.9,
                    image: "https://images.unsplash.com/photo-1535958636474-b021ee887b13?w=400",
                    description: "IPA artesanal mexicana con lúpulos tropicales y notas de mango",
                    abv: "6.5%",
                    ibu: "65",
                    featured: true,
                    pais: "México",
                    cerveceria: "Cervecería Cucapá",
                    stock: 30
                },
                {
                    id: 13,
                    name: "Cerveza Calavera",
                    style: "Stout",
                    price: 88.99,
                    rating: 4.8,
                    image: "https://images.unsplash.com/photo-1608270586620-248524c67de9?w=400",
                    description: "Stout artesanal mexicana con café local y notas de chocolate",
                    abv: "7.2%",
                    ibu: "35",
                    featured: true,
                    pais: "México",
                    cerveceria: "Cervecería Calavera",
                    stock: 25
                },
                {
                    id: 14,
                    name: "Cerveza Tijuana",
                    style: "Wheat Beer",
                    price: 72.99,
                    rating: 4.6,
                    image: "https://images.unsplash.com/photo-1618885472179-5e474019f2a9?w=400",
                    description: "Cerveza de trigo artesanal mexicana con notas de banana y clavo",
                    abv: "5.4%",
                    ibu: "18",
                    featured: true,
                    pais: "México",
                    cerveceria: "Cervecería Tijuana",
                    stock: 40
                },
                {
                    id: 15,
                    name: "Cerveza Insurgente",
                    style: "Imperial Stout",
                    price: 125.99,
                    rating: 4.9,
                    image: "https://images.unsplash.com/photo-1608270586620-248524c67de9?w=400",
                    description: "Imperial Stout artesanal mexicana envejecida en barricas de bourbon",
                    abv: "10.5%",
                    ibu: "55",
                    featured: true,
                    pais: "México",
                    cerveceria: "Cervecería Insurgente",
                    stock: 15
                }
            ];
            
            // Renderizar cervezas después de cargar
            renderBeers();
        }

        // Estado de la aplicación
        let cart = [];
        let currentView = 'loginView';
        let userPoints = 1250;
        let appliedDiscount = 0;

        // Funciones de utilidad
        function showView(viewId) {
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
            document.getElementById(viewId).classList.add('active');
            currentView = viewId;
        }

        function showMessage(text, type = 'info') {
            const popup = document.getElementById('messagePopup');
            const messageText = document.getElementById('messageText');
            popup.className = `message-popup ${type}`;
            messageText.textContent = text;
            popup.classList.add('show');
            setTimeout(() => popup.classList.remove('show'), 3000);
        }

        // Login
        document.getElementById('loginForm').addEventListener('submit', (e) => {
            e.preventDefault();
            showMessage('¡Inicio de sesión exitoso!', 'success');
            setTimeout(() => showView('dashboardView'), 1000);
        });

        // Toggle password visibility
        document.querySelectorAll('.password-toggle').forEach(toggle => {
            toggle.addEventListener('click', function() {
                const input = this.previousElementSibling;
                const icon = this.querySelector('i');
                if (input.type === 'password') {
                    input.type = 'text';
                    icon.className = 'fas fa-eye-slash';
                } else {
                    input.type = 'password';
                    icon.className = 'fas fa-eye';
                }
            });
        });

        // Navegación registro
        document.getElementById('showSignup').addEventListener('click', (e) => {
            e.preventDefault();
            showView('signupView');
        });

        document.getElementById('backToLogin').addEventListener('click', () => {
            showView('loginView');
        });

        // Manejo de subida de archivos con validación
        function setupFileUpload(inputId, previewId, fileNameId, removeId) {
            const input = document.getElementById(inputId);
            const preview = document.getElementById(previewId);
            const previewImg = document.querySelector(`#${previewId} img`);
            const fileName = document.getElementById(fileNameId);
            const removeBtn = document.getElementById(removeId);
            
            input.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    // Validar tamaño (5MB máximo)
                    if (file.size > 5 * 1024 * 1024) {
                        showMessage('El archivo es demasiado grande. Máximo 5MB', 'error');
                        input.value = '';
                        return;
                    }
                    
                    // Validar tipo
                    if (!file.type.match('image/(jpeg|jpg|png)')) {
                        showMessage('Solo se aceptan archivos JPG o PNG', 'error');
                        input.value = '';
                        return;
                    }
                    
                    fileName.textContent = file.name;
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        previewImg.src = e.target.result;
                        preview.style.display = 'block';
                        checkStep0Complete();
                    };
                    reader.readAsDataURL(file);
                }
            });
            
            removeBtn.addEventListener('click', () => {
                input.value = '';
                preview.style.display = 'none';
                fileName.textContent = 'Seleccionar archivo';
                checkStep0Complete();
            });
        }

        setupFileUpload('idPhotoFront', 'frontPreview', 'frontFileName', 'removeFront');
        setupFileUpload('idPhotoBack', 'backPreview', 'backFileName', 'removeBack');

        // Validación paso 0 (Verificación de identidad)
        function checkStep0Complete() {
            const idType = document.getElementById('idType').value;
            const idNumber = document.getElementById('idNumber').value;
            const frontFile = document.getElementById('idPhotoFront').files[0];
            const backFile = document.getElementById('idPhotoBack').files[0];
            const nextBtn = document.getElementById('nextToStep1');
            
            if (idType && idNumber.length >= 5 && frontFile && backFile) {
                nextBtn.disabled = false;
            } else {
                nextBtn.disabled = true;
            }
        }

        document.getElementById('idType').addEventListener('change', checkStep0Complete);
        document.getElementById('idNumber').addEventListener('input', checkStep0Complete);

        // Validación de contraseña
        function checkPasswordStrength(password) {
            let strength = 0;
            const requirements = {
                length: password.length >= 8,
                uppercase: /[A-Z]/.test(password),
                lowercase: /[a-z]/.test(password),
                number: /[0-9]/.test(password),
                special: /[@$!%*?&]/.test(password)
            };
            
            // Actualizar requisitos visuales
            document.getElementById('req-length').classList.toggle('valid', requirements.length);
            document.getElementById('req-uppercase').classList.toggle('valid', requirements.uppercase);
            document.getElementById('req-lowercase').classList.toggle('valid', requirements.lowercase);
            document.getElementById('req-number').classList.toggle('valid', requirements.number);
            document.getElementById('req-special').classList.toggle('valid', requirements.special);
            
            Object.values(requirements).forEach(req => { if (req) strength++; });
            
            return { strength, requirements };
        }

        document.getElementById('signupPassword').addEventListener('input', function() {
            const password = this.value;
            const strengthDiv = document.getElementById('passwordStrength');
            const strengthBar = document.getElementById('strengthBarFill');
            const strengthText = document.getElementById('strengthText');
            
            if (password.length > 0) {
                strengthDiv.style.display = 'block';
                const { strength, requirements } = checkPasswordStrength(password);
                
                const percentage = (strength / 5) * 100;
                strengthBar.style.width = percentage + '%';
                
                if (strength <= 2) {
                    strengthBar.style.background = '#e74c3c';
                    strengthText.textContent = 'Débil';
                    strengthText.style.color = '#e74c3c';
                } else if (strength <= 3) {
                    strengthBar.style.background = '#f39c12';
                    strengthText.textContent = 'Media';
                    strengthText.style.color = '#f39c12';
                } else if (strength <= 4) {
                    strengthBar.style.background = '#3498db';
                    strengthText.textContent = 'Buena';
                    strengthText.style.color = '#3498db';
                } else {
                    strengthBar.style.background = '#27ae60';
                    strengthText.textContent = 'Excelente';
                    strengthText.style.color = '#27ae60';
                }
                
                checkPasswordsMatch();
            } else {
                strengthDiv.style.display = 'none';
            }
        });

        function checkPasswordsMatch() {
        const password = document.getElementById('signupPassword').value;
        const confirmPassword = document.getElementById('signupConfirmPassword').value;
            const matchMsg = document.getElementById('passwordMatchValidation');
            const nextBtn = document.getElementById('nextToStep3');
            const { requirements } = checkPasswordStrength(password);
        
            const allReqMet = Object.values(requirements).every(req => req);
        
            if (confirmPassword.length > 0) {
        if (password !== confirmPassword) {
                    matchMsg.textContent = 'Las contraseñas no coinciden';
                    matchMsg.style.display = 'block';
                    nextBtn.disabled = true;
                } else if (!allReqMet) {
                    matchMsg.textContent = 'La contraseña no cumple todos los requisitos';
                    matchMsg.style.display = 'block';
                    nextBtn.disabled = true;
                } else {
                    matchMsg.textContent = '✓ Las contraseñas coinciden';
                    matchMsg.style.color = '#27ae60';
                    matchMsg.style.display = 'block';
                    nextBtn.disabled = false;
                }
            } else {
                matchMsg.style.display = 'none';
                nextBtn.disabled = true;
            }
        }

        document.getElementById('signupConfirmPassword').addEventListener('input', checkPasswordsMatch);

        // Validación de edad
        document.getElementById('signupAge').addEventListener('change', function() {
            const birthDate = new Date(this.value);
            const today = new Date();
            let age = today.getFullYear() - birthDate.getFullYear();
            const monthDiff = today.getMonth() - birthDate.getMonth();
            
            if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) {
                age--;
            }
            
            const ageMsg = document.getElementById('ageValidationMsg');
            const submitBtn = document.getElementById('submitSignup');
        
        if (age < 18) {
                ageMsg.style.display = 'block';
                this.setCustomValidity('Debes ser mayor de 18 años');
            } else {
                ageMsg.style.display = 'none';
                this.setCustomValidity('');
            }
            
            checkStep3Complete();
        });

        // Validación final paso 3
        function checkStep3Complete() {
            const age = document.getElementById('signupAge').value;
            const phone = document.getElementById('signupPhone').value;
            const address = document.getElementById('signupAddress').value;
            const confirmAge = document.getElementById('confirmLegalAge').checked;
            const acceptTerms = document.getElementById('acceptTerms').checked;
            const submitBtn = document.getElementById('submitSignup');
            
            if (age && phone.length >= 10 && address.length >= 10 && confirmAge && acceptTerms) {
                submitBtn.disabled = false;
            } else {
                submitBtn.disabled = true;
            }
        }

        document.getElementById('signupPhone').addEventListener('input', checkStep3Complete);
        document.getElementById('signupAddress').addEventListener('input', checkStep3Complete);
        document.getElementById('confirmLegalAge').addEventListener('change', checkStep3Complete);
        document.getElementById('acceptTerms').addEventListener('change', checkStep3Complete);

        // Navegación entre pasos
        const steps = ['step0', 'step1', 'step2', 'step3'];
        let currentStep = 0;

        function updateProgressBar() {
            document.querySelectorAll('.progress-step').forEach((step, index) => {
                step.classList.toggle('active', index <= currentStep);
            });
        }

        function goToStep(stepIndex) {
            document.querySelectorAll('.form-step').forEach(step => step.classList.remove('active'));
            document.getElementById(steps[stepIndex]).classList.add('active');
            currentStep = stepIndex;
            updateProgressBar();
        }

        document.getElementById('nextToStep1').addEventListener('click', () => goToStep(1));
        document.getElementById('backToStep0').addEventListener('click', () => goToStep(0));
        document.getElementById('nextToStep2').addEventListener('click', () => goToStep(2));
        document.getElementById('backToStep1').addEventListener('click', () => goToStep(1));
        document.getElementById('nextToStep3').addEventListener('click', () => goToStep(3));
        document.getElementById('backToStep2').addEventListener('click', () => goToStep(2));

        // Submit registro
        document.getElementById('signupForm').addEventListener('submit', (e) => {
            e.preventDefault();
            showMessage('¡Cuenta creada exitosamente! Bienvenido a Cerveza Premium', 'success');
            setTimeout(() => {
                showView('dashboardView');
                goToStep(0);
                document.getElementById('signupForm').reset();
            }, 2000);
        });

        // Dashboard navegación
        document.getElementById('orderDelivery').addEventListener('click', () => {
            // Si hay items en el carrito, ir directo al carrito con delivery seleccionado
            if (cart.length > 0) {
                showView('cartView');
                renderCart();
                setTimeout(() => {
                    document.getElementById('deliveryOption').checked = true;
                    document.getElementById('deliveryOption').dispatchEvent(new Event('change'));
                }, 300);
            } else {
                // Si no hay items, ir al catálogo
                showView('catalogView');
                renderBeers();
                showMessage('Selecciona tus cervezas favoritas para ordenar a domicilio 🍺', 'info');
            }
        });

        document.getElementById('showCatalog').addEventListener('click', () => {
            showView('catalogView');
            loadMexicanBeers();
        });

        document.getElementById('showCart').addEventListener('click', () => {
            showView('cartView');
            renderCart();
        });

        document.getElementById('showOrders').addEventListener('click', () => showView('ordersView'));
        document.getElementById('showProfile').addEventListener('click', () => showView('profileView'));
        document.getElementById('logoutBtn').addEventListener('click', () => {
            showMessage('Sesión cerrada exitosamente', 'info');
            setTimeout(() => showView('loginView'), 1000);
        });

        // Botones de regreso
        document.getElementById('backToDashboard').addEventListener('click', () => showView('dashboardView'));
        document.getElementById('backToDashboardFromCart').addEventListener('click', () => showView('dashboardView'));
        document.getElementById('backToDashboardFromProfile').addEventListener('click', () => showView('dashboardView'));
        document.getElementById('backToDashboardFromOrders').addEventListener('click', () => showView('dashboardView'));
        document.getElementById('goToCart').addEventListener('click', () => {
            showView('cartView');
            renderCart();
        });
        document.getElementById('continueShopping').addEventListener('click', () => {
            showView('catalogView');
            loadMexicanBeers();
        });

        // Renderizar cervezas mejorado
        const searchInput = document.getElementById('searchBeer');
        const clearSearchBtn = document.getElementById('clearSearch');
        const filterStyle = document.getElementById('filterStyle');
        const filterPrice = document.getElementById('filterPrice');
        const filterRating = document.getElementById('filterRating');
        const filterCategory = document.getElementById('filterCategory');
        const sortSelect = document.getElementById('sortBy');
        const quickFilterButtons = document.querySelectorAll('.quick-filter');
        const toggleViewBtn = document.getElementById('toggleView');
        const viewModeLabel = document.getElementById('viewModeLabel');
        let currentCatalogView = 'grid';
        let activeQuickFilterId = '';

        function toggleClearSearchButton(value) {
            if (!clearSearchBtn) return;
            clearSearchBtn.style.display = value ? 'flex' : 'none';
        }

        toggleClearSearchButton(searchInput ? searchInput.value : '');

        if (searchInput) {
            searchInput.addEventListener('input', (event) => {
                toggleClearSearchButton(event.target.value);
                renderBeers();
            });
        }

        if (clearSearchBtn) {
            clearSearchBtn.addEventListener('click', () => {
                if (searchInput) {
                    searchInput.value = '';
                }
                toggleClearSearchButton('');
                renderBeers();
            });
        }

        const filterControls = [filterStyle, filterPrice, filterRating, filterCategory];
        filterControls.forEach(control => {
            if (control) {
                control.addEventListener('change', () => {
                    resetQuickFilters();
                    renderBeers();
                });
            }
        });

        if (sortSelect) {
            sortSelect.addEventListener('change', () => renderBeers());
        }

        if (toggleViewBtn) {
            toggleViewBtn.addEventListener('click', () => {
                currentCatalogView = currentCatalogView === 'grid' ? 'list' : 'grid';
                toggleViewBtn.innerHTML = currentCatalogView === 'grid' ? '<i class="fas fa-th"></i>' : '<i class="fas fa-bars"></i>';
                if (viewModeLabel) {
                    viewModeLabel.textContent = currentCatalogView === 'grid' ? 'Vista en cuadrícula' : 'Vista tipo lista';
                }
                renderBeers();
            });
        }

        function resetQuickFilters() {
            quickFilterButtons.forEach(btn => btn.classList.remove('active'));
            activeQuickFilterId = '';
        }

        function resetCatalogFilters(options = {}) {
            const preserveSearch = options.preserveSearch || false;
            if (!preserveSearch && searchInput) {
                searchInput.value = '';
                toggleClearSearchButton('');
            }
            if (filterStyle) filterStyle.value = '';
            if (filterPrice) filterPrice.value = '';
            if (filterRating) filterRating.value = '';
            if (filterCategory) filterCategory.value = '';
            if (sortSelect) sortSelect.value = 'default';
            resetQuickFilters();
        }

        quickFilterButtons.forEach(btn => {
            btn.addEventListener('click', () => {
                const filterId = btn.dataset.filterId;
                if (activeQuickFilterId === filterId) {
                    resetCatalogFilters({ preserveSearch: true });
                } else {
                    resetCatalogFilters({ preserveSearch: true });
                    btn.classList.add('active');
                    activeQuickFilterId = filterId;
                    const targetSelect = document.getElementById(btn.dataset.select);
                    if (targetSelect) {
                        targetSelect.value = btn.dataset.value || '';
                    }
                }
                renderBeers();
            });
        });

        const clearFiltersBtn = document.getElementById('clearFilters');
        if (clearFiltersBtn) {
            clearFiltersBtn.addEventListener('click', () => {
                resetCatalogFilters();
                renderBeers();
            });
        }

        const heroOrderBtn = document.getElementById('heroOrderDelivery');
        if (heroOrderBtn) {
            heroOrderBtn.addEventListener('click', () => {
                const deliveryShortcut = document.getElementById('orderDelivery');
                if (deliveryShortcut) {
                    deliveryShortcut.click();
                } else {
                    showMessage('Dirígete al dashboard para programar tu entrega', 'info');
                }
            });
        }

        const heroFavoritesBtn = document.getElementById('heroViewFavorites');
        if (heroFavoritesBtn) {
            heroFavoritesBtn.addEventListener('click', () => showView('favoritesView'));
        }

        function updateHeroStats() {
            const total = beers.length;
            const premium = beers.filter(beer => beer.price >= 100).length;
            const craft = beers.filter(beer => beer.cerveceria && !/grupo modelo|heineken/i.test(beer.cerveceria)).length;
            const heroProductsEl = document.getElementById('heroProducts');
            const heroPremiumEl = document.getElementById('heroPremium');
            const heroCraftEl = document.getElementById('heroCraft');
            if (heroProductsEl) heroProductsEl.textContent = total.toString().padStart(2, '0');
            if (heroPremiumEl) heroPremiumEl.textContent = premium.toString().padStart(2, '0');
            if (heroCraftEl) heroCraftEl.textContent = craft.toString().padStart(2, '0');
        }

        function updateCatalogInsights(list) {
            const ratingEl = document.getElementById('insightRating');
            const priceEl = document.getElementById('insightPrice');
            const stockEl = document.getElementById('insightStock');
            const styleEl = document.getElementById('insightStyle');

            if (!ratingEl || !priceEl || !stockEl || !styleEl) return;

            if (list.length === 0) {
                ratingEl.textContent = '0.0 ★';
                priceEl.textContent = '$0.00';
                stockEl.textContent = '0';
                styleEl.textContent = '—';
                return;
            }

            const avgRating = list.reduce((sum, beer) => sum + (beer.rating || 0), 0) / list.length;
            const avgPrice = list.reduce((sum, beer) => sum + (beer.price || 0), 0) / list.length;
            const totalStock = list.reduce((sum, beer) => sum + (beer.stock || 0), 0);
            const stylesCount = list.reduce((map, beer) => {
                if (!beer.style) return map;
                map[beer.style] = (map[beer.style] || 0) + 1;
                return map;
            }, {});
            const topStyle = Object.keys(stylesCount).sort((a, b) => stylesCount[b] - stylesCount[a])[0] || '—';

            ratingEl.textContent = `${avgRating.toFixed(1)} ★`;
            priceEl.textContent = `$${avgPrice.toFixed(2)}`;
            stockEl.textContent = totalStock.toLocaleString();
            styleEl.textContent = topStyle;
        }

        function sortBeers(list, sortValue) {
            const sorted = [...list];
            switch (sortValue) {
                case 'price-asc':
                    return sorted.sort((a, b) => a.price - b.price);
                case 'price-desc':
                    return sorted.sort((a, b) => b.price - a.price);
                case 'rating-desc':
                    return sorted.sort((a, b) => b.rating - a.rating);
                case 'name-asc':
                    return sorted.sort((a, b) => a.name.localeCompare(b.name));
                case 'name-desc':
                    return sorted.sort((a, b) => b.name.localeCompare(a.name));
                default:
                    return sorted.sort((a, b) => {
                        if (a.featured && !b.featured) return -1;
                        if (!a.featured && b.featured) return 1;
                        return b.rating - a.rating;
                    });
            }
        }

        function createBeerCardMarkup(beer) {
            const isListMode = currentCatalogView === 'list';
            const rating = beer.rating || 0;
            const starCount = Math.min(5, Math.round(rating));
            const filledStars = '★'.repeat(starCount);
            const emptyStars = '☆'.repeat(5 - starCount);
            const premiumBadge = beer.price > 100 ? '<span class="premium-badge">Premium</span>' : '';
            const listClass = isListMode ? 'list-mode' : '';
            const stockLabel = beer.stock ? `${beer.stock} en stock` : 'Stock bajo';

            return `
                <div class="beer-card ${beer.featured ? 'featured' : ''} ${listClass}">
                    ${beer.featured ? '<div class="featured-badge"><i class="fas fa-star"></i> Destacada</div>' : ''}
                    <div class="beer-image-container">
                        <img src="${window.normalizeImageUrl ? window.normalizeImageUrl(beer.image, beer.name) : beer.image}" alt="${beer.name}" class="beer-image">
                        <div class="beer-overlay">
                            <button class="quick-view-btn" onclick="showBeerDetails(${beer.id})">
                                <i class="fas fa-eye"></i> Ver Detalles
                            </button>
                        </div>
                    </div>
                    <div class="beer-info">
                        <div class="beer-info-header">
                            <div>
                                <h3 class="beer-name">${beer.name}</h3>
                                <p class="beer-style">${beer.style || 'Sin estilo'}</p>
                            </div>
                            <span class="beer-stock">
                                <i class="fas fa-box"></i> ${stockLabel}
                            </span>
                        </div>
                        <p class="beer-description">${beer.description || 'Sin descripción disponible.'}</p>
                        <div class="beer-specs">
                            <span class="spec-item"><i class="fas fa-tint"></i> ${beer.abv || '--'}</span>
                            <span class="spec-item"><i class="fas fa-leaf"></i> ${beer.ibu ? `${beer.ibu} IBU` : 'IBU N/D'}</span>
                            ${beer.pais ? `<span class="spec-item"><i class="fas fa-flag"></i> ${beer.pais}</span>` : ''}
                            ${beer.cerveceria ? `<span class="spec-item"><i class="fas fa-industry"></i> ${beer.cerveceria}</span>` : ''}
                        </div>
                        <div class="beer-rating">
                            ${filledStars}${emptyStars}
                            <span class="rating-number">${rating.toFixed(1)}</span>
                        </div>
                        <div class="beer-tags">
                            ${beer.featured ? '<span class="beer-tag"><i class="fas fa-fire"></i> Más vendido</span>' : ''}
                            ${beer.price >= 120 ? '<span class="beer-tag"><i class="fas fa-gem"></i> Alta gama</span>' : ''}
                        </div>
                        <div class="beer-card-footer">
                            <div class="beer-price-container">
                                <span class="beer-price">$${beer.price.toFixed(2)}</span>
                                ${premiumBadge}
                            </div>
                            <div class="beer-card-actions">
                                <button class="add-to-cart-btn" onclick="addToCart(${beer.id}, this)">
                                    <i class="fas fa-cart-plus"></i>
                                    <span class="button-label">Agregar</span>
                                    <span class="button-spinner" aria-hidden="true"></span>
                                </button>
                                <button class="ghost-btn" onclick="showBeerDetails(${beer.id})">
                                    <i class="fas fa-circle-info"></i> Detalles
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderBeers() {
            const grid = document.getElementById('beerGrid');
            if (!grid) return;
            const searchTerm = (searchInput?.value || '').toLowerCase().trim();
            const styleFilter = filterStyle ? filterStyle.value : '';
            const priceFilter = filterPrice ? filterPrice.value : '';
            const ratingFilter = filterRating ? filterRating.value : '';
            const categoryFilter = filterCategory ? filterCategory.value : '';
            const sortValue = sortSelect ? sortSelect.value : 'default';
            
            let filtered = beers.filter(beer => {
                const name = (beer.name || '').toLowerCase();
                const style = (beer.style || '').toLowerCase();
                const description = (beer.description || '').toLowerCase();

                const matchesSearch = !searchTerm || name.includes(searchTerm) || style.includes(searchTerm) || description.includes(searchTerm);
                const matchesStyle = !styleFilter || beer.style === styleFilter;
                
                let matchesPrice = true;
                if (priceFilter) {
                    const [min, max] = priceFilter.split('-').map(p => p.replace('+', ''));
                    const minValue = parseFloat(min || '0');
                    const maxValue = max ? parseFloat(max) : null;
                    matchesPrice = maxValue ? (beer.price >= minValue && beer.price <= maxValue) : beer.price >= minValue;
                }
                
                let matchesRating = true;
                if (ratingFilter) {
                    const minRating = parseFloat(ratingFilter.replace('+', ''));
                    matchesRating = (beer.rating || 0) >= minRating;
                }
                
                let matchesCategory = true;
                if (categoryFilter) {
                    const brewery = beer.cerveceria || '';
                    switch(categoryFilter) {
                        case 'featured':
                            matchesCategory = beer.featured;
                            break;
                        case 'premium':
                            matchesCategory = beer.price >= 100;
                            break;
                        case 'artesanal':
                            matchesCategory = brewery && !/grupo modelo|heineken/i.test(brewery);
                            break;
                        case 'comercial':
                            matchesCategory = brewery && /grupo modelo|heineken/i.test(brewery);
                            break;
                        case 'grupo-modelo':
                            matchesCategory = brewery && /grupo modelo/i.test(brewery);
                            break;
                        case 'heineken':
                            matchesCategory = brewery && /heineken/i.test(brewery);
                            break;
                    }
                }
                
                return matchesSearch && matchesStyle && matchesPrice && matchesRating && matchesCategory;
            });

            filtered = sortBeers(filtered, sortValue);

            const resultsInfo = document.getElementById('resultsInfo');
            const resultsCount = document.getElementById('resultsCount');
            if (resultsCount) resultsCount.textContent = filtered.length;
            if (resultsInfo) resultsInfo.style.display = filtered.length >= 0 ? 'flex' : 'none';

            updateHeroStats();
            updateCatalogInsights(filtered);

            grid.classList.toggle('list-view', currentCatalogView === 'list');

            if (filtered.length === 0) {
                grid.innerHTML = `
                    <div class="empty-results">
                        <div class="empty-results-icon"><i class="fas fa-ghost"></i></div>
                        <p>No encontramos cervezas con esos criterios.</p>
                        <button class="filter-btn empty-reset-btn" type="button">
                            <i class="fas fa-undo"></i> Quitar filtros
                        </button>
                    </div>
                `;
                const resetBtn = grid.querySelector('.empty-reset-btn');
                if (resetBtn) {
                    resetBtn.addEventListener('click', () => {
                        resetCatalogFilters();
                        renderBeers();
                    });
                }
                return;
            }

            grid.innerHTML = filtered.map(beer => createBeerCardMarkup(beer)).join('');
        }

        // Mostrar detalles de cerveza
        function showBeerDetails(beerId) {
            const beer = beers.find(b => b.id === beerId);
            if (!beer) return;
            
            const modal = document.createElement('div');
            modal.className = 'beer-details-modal';
            modal.innerHTML = `
                <div class="modal-content">
                    <button class="close-modal" onclick="this.closest('.beer-details-modal').remove()">
                        <i class="fas fa-times"></i>
                    </button>
                    <div class="beer-details-container">
                        <div class="beer-details-image">
                            <img src="${window.normalizeImageUrl ? window.normalizeImageUrl(beer.image, beer.name) : beer.image}" alt="${beer.name}">
                            ${beer.featured ? '<div class="featured-badge"><i class="fas fa-star"></i> Destacada</div>' : ''}
                        </div>
                        <div class="beer-details-info">
                            <h2>${beer.name}</h2>
                            <p class="beer-style">${beer.style}</p>
                            <div class="beer-rating">
                                ${'★'.repeat(Math.floor(beer.rating))}${'☆'.repeat(5 - Math.floor(beer.rating))} 
                                <span class="rating-number">${beer.rating}</span>
                            </div>
                            <p class="beer-description">${beer.description}</p>
                            <div class="beer-specs-detailed">
                                <div class="spec-row">
                                    <span class="spec-label">Alcohol (ABV):</span>
                                    <span class="spec-value">${beer.abv}</span>
                                </div>
                                <div class="spec-row">
                                    <span class="spec-label">Amargor (IBU):</span>
                                    <span class="spec-value">${beer.ibu}</span>
                                </div>
                                ${beer.pais ? `
                                <div class="spec-row">
                                    <span class="spec-label">País:</span>
                                    <span class="spec-value">${beer.pais}</span>
                                </div>
                                ` : ''}
                                ${beer.cerveceria ? `
                                <div class="spec-row">
                                    <span class="spec-label">Cervecería:</span>
                                    <span class="spec-value">${beer.cerveceria}</span>
                                </div>
                                ` : ''}
                                ${beer.stock ? `
                                <div class="spec-row">
                                    <span class="spec-label">Stock:</span>
                                    <span class="spec-value">${beer.stock} unidades</span>
                                </div>
                                ` : ''}
                                <div class="spec-row">
                                    <span class="spec-label">Precio:</span>
                                    <span class="spec-value price">$${beer.price.toFixed(2)}</span>
                                </div>
                            </div>
                            <div class="beer-actions">
                                <button class="add-to-cart-btn large" onclick="addToCartFromModal(${beer.id}, this)">
                                    <i class="fas fa-cart-plus"></i>
                                    <span class="button-label">Agregar</span>
                                    <span class="button-spinner" aria-hidden="true"></span>
                                </button>
                                <button class="close-modal-btn" onclick="this.closest('.beer-details-modal').remove()">
                                    Cerrar
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // Agregar al carrito
        function addToCart(beerId, button = null) {
            const beer = beers.find(b => b.id === beerId);
            const existingItem = cart.find(item => item.id === beerId);
            
            if (existingItem) {
                existingItem.quantity++;
            } else {
                cart.push({ ...beer, quantity: 1 });
            }
            
            animateAddToCartButton(button);
            updateCartBadge();
            showMessage(`${beer.name} agregado al carrito`, 'success');
        }

        function addToCartFromModal(beerId, button) {
            addToCart(beerId, button);
            setTimeout(() => {
                const modal = button.closest('.beer-details-modal');
                if (modal) {
                    modal.remove();
                }
            }, 800);
        }

        function animateAddToCartButton(button) {
            if (!button || button.classList.contains('loading')) return;
            
            const label = button.querySelector('.button-label');
            const icon = button.querySelector('i');
            if (label && !button.dataset.defaultLabel) {
                button.dataset.defaultLabel = label.textContent || 'Agregar';
            }
            
            button.classList.add('loading');
            button.disabled = true;
            if (label) label.textContent = 'Agregando...';
            
            setTimeout(() => {
                button.classList.remove('loading');
                button.classList.add('success');
                if (label) label.textContent = 'Agregado';
                if (icon) icon.className = 'fas fa-check';
                
                setTimeout(() => {
                    button.classList.remove('success');
                    button.disabled = false;
                    if (label) label.textContent = button.dataset.defaultLabel || 'Agregar';
                    if (icon) icon.className = 'fas fa-cart-plus';
                }, 1200);
            }, 900);
        }

        // Actualizar badge del carrito
        function updateCartBadge() {
            const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
            const badges = [
                document.getElementById('cartBadge'),
                document.getElementById('catalogCartBadge')
            ];
            
            badges.forEach(badge => {
                if (totalItems > 0) {
                    badge.textContent = totalItems;
                    badge.style.display = 'inline-block';
                } else {
                    badge.style.display = 'none';
                }
            });
        }

        // Renderizar carrito
        function renderCart() {
            const cartItemsDiv = document.getElementById('cartItems');
            const emptyCart = document.getElementById('emptyCart');
            const summarySection = document.getElementById('cartSummarySection');
            
            if (cart.length === 0) {
                cartItemsDiv.innerHTML = '';
                emptyCart.style.display = 'block';
                summarySection.style.display = 'none';
                return;
            }
            
            emptyCart.style.display = 'none';
            summarySection.style.display = 'block';
            
            cartItemsDiv.innerHTML = cart.map(item => `
                <div class="cart-item">
                    <img src="${item.image}" alt="${item.name}" class="cart-item-image">
                    <div class="cart-item-details">
                        <div class="cart-item-name">${item.name}</div>
                        <div class="cart-item-price">${item.price.toFixed(2)}</div>
                    </div>
                    <div class="cart-item-controls">
                        <div class="quantity-control">
                            <button class="quantity-btn" onclick="updateQuantity(${item.id}, -1)">
                                <i class="fas fa-minus"></i>
                            </button>
                            <span class="quantity-value">${item.quantity}</span>
                            <button class="quantity-btn" onclick="updateQuantity(${item.id}, 1)">
                                <i class="fas fa-plus"></i>
                            </button>
                        </div>
                        <button class="remove-item-btn" onclick="removeFromCart(${item.id})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            `).join('');
            
            updateCartSummary();
        }

        // Actualizar cantidad
        function updateQuantity(beerId, change) {
            const item = cart.find(i => i.id === beerId);
            if (item) {
                item.quantity += change;
                if (item.quantity <= 0) {
                    removeFromCart(beerId);
                } else {
                    renderCart();
                    updateCartBadge();
                }
            }
        }

        // Remover del carrito
        function removeFromCart(beerId) {
            cart = cart.filter(item => item.id !== beerId);
            renderCart();
            updateCartBadge();
            showMessage('Producto eliminado del carrito', 'info');
        }

        // Actualizar resumen del carrito
        function updateCartSummary() {
            const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const shipping = 3.99;
            const total = subtotal - appliedDiscount + shipping;
            const pointsToEarn = Math.floor(total * 10);
            
            document.getElementById('subtotal').textContent = `${subtotal.toFixed(2)}`;
            document.getElementById('total').textContent = `${total.toFixed(2)}`;
            document.getElementById('pointsToEarn').textContent = `+${pointsToEarn} pts`;
            
            if (appliedDiscount > 0) {
                document.getElementById('discountRow').style.display = 'flex';
                document.getElementById('discountTotal').textContent = `-${appliedDiscount.toFixed(2)}`;
            } else {
                document.getElementById('discountRow').style.display = 'none';
            }
        }

        // Aplicar puntos
        document.getElementById('applyPointsBtn').addEventListener('click', () => {
            const pointsToUse = parseInt(document.getElementById('pointsToUse').value) || 0;
            const maxPoints = userPoints;
            const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            
            if (pointsToUse <= 0) {
                showMessage('Ingresa una cantidad válida de puntos', 'error');
                return;
            }
            
            if (pointsToUse > maxPoints) {
                showMessage(`Solo tienes ${maxPoints} puntos disponibles`, 'error');
                return;
            }
            
            // 100 puntos = $1 de descuento
            const discount = pointsToUse / 100;
            
            if (discount > subtotal) {
                showMessage('El descuento no puede ser mayor al subtotal', 'error');
                return;
            }
            
            appliedDiscount = discount;
            document.getElementById('discountAmount').textContent = discount.toFixed(2);
            document.getElementById('pointsDiscount').style.display = 'block';
            updateCartSummary();
            showMessage(`Descuento de ${discount.toFixed(2)} aplicado`, 'success');
        });

        // Checkout
        document.getElementById('checkoutBtn').addEventListener('click', () => {
            if (cart.length === 0) {
                showMessage('Tu carrito está vacío', 'error');
                return;
            }
            
            // Validar si es entrega a domicilio
            const deliveryMethod = document.querySelector('input[name="deliveryMethod"]:checked').value;
            
            if (deliveryMethod === 'delivery') {
                // Validar campos de dirección
                const street = document.getElementById('deliveryStreet').value;
                const colony = document.getElementById('deliveryColony').value;
                const postalCode = document.getElementById('deliveryPostalCode').value;
                const city = document.getElementById('deliveryCity').value;
                const state = document.getElementById('deliveryState').value;
                const phone = document.getElementById('deliveryPhone').value;
                
                if (!street || !colony || !postalCode || !city || !state || !phone) {
                    showMessage('Por favor completa todos los campos de dirección', 'error');
                    return;
                }
                
                // Validar pedido mínimo
                const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
                if (subtotal < 100) {
                    showMessage('El pedido mínimo para entrega a domicilio es $100', 'error');
                    return;
                }
                
                // Guardar información de entrega
                const deliveryInfo = {
                    method: 'delivery',
                    address: {
                        street: street,
                        colony: colony,
                        postalCode: postalCode,
                        city: city,
                        state: state,
                        references: document.getElementById('deliveryReferences').value,
                        phone: phone
                    },
                    shippingCost: parseFloat(document.getElementById('shippingCost').textContent.replace('$', '').replace('Gratis', '0'))
                };
                
                console.log('Información de entrega:', deliveryInfo);
                
                // Guardar dirección si el checkbox está marcado
                if (document.getElementById('saveAddress').checked) {
                    console.log('Guardando dirección para futuros pedidos...');
                    // Aquí se guardaría la dirección en la BD
                }
            }
            
            const pointsUsed = parseInt(document.getElementById('pointsToUse').value) || 0;
            const pointsEarned = parseInt(document.getElementById('pointsToEarn').textContent);
            
            userPoints = userPoints - pointsUsed + pointsEarned;
            document.getElementById('pointsBalance').textContent = userPoints.toLocaleString();
            document.getElementById('availablePoints').textContent = userPoints.toLocaleString();
            
            const deliveryType = deliveryMethod === 'delivery' ? 'a domicilio' : 'para recoger en tienda';
            showMessage(`¡Pedido ${deliveryType} realizado exitosamente! Gracias por tu compra 🍺`, 'success');
            
            // Limpiar carrito
            cart = [];
            appliedDiscount = 0;
            document.getElementById('pointsToUse').value = '';
            document.getElementById('pointsDiscount').style.display = 'none';
            
            // Resetear opciones de entrega
            document.getElementById('pickupOption').checked = true;
            document.getElementById('deliveryAddressSection').style.display = 'none';
            
            setTimeout(() => {
                showView('dashboardView');
                updateCartBadge();
            }, 2500);
        });

        // Cerrar mensaje
        document.getElementById('closeMessage').addEventListener('click', () => {
            document.getElementById('messagePopup').classList.remove('show');
        });

        // Inicializar
        renderBeers();
  </script>
  
  <!-- Chatbot -->
  <app-chatbot></app-chatbot>
</body>
</html>